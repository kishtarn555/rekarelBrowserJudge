!function(){"use strict";let selectedDirectoryHandle=null;var kareljava=function(){var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,5],$V1=[4,16],$V2=[1,19],$V3=[1,20],$V4=[1,21],$V5=[5,28,29,30],$V6=[1,29],$V7=[8,9,18,27,53,54,55,56,57],$V8=[1,39],$V9=[6,11,18,19,32,33,34,35,36,37,38,44,47,50,51],$Va=[9,27],$Vb=[1,71],$Vc=[1,58],$Vd=[1,59],$Ve=[1,60],$Vf=[1,61],$Vg=[1,62],$Vh=[1,63],$Vi=[1,64],$Vj=[1,72],$Vk=[1,74],$Vl=[1,75],$Vm=[1,76],$Vn=[6,11,18,19,32,33,34,35,36,37,38,44,47,49,50,51],$Vo=[1,93],$Vp=[1,95],$Vq=[1,100],$Vr=[1,101],$Vs=[1,102],$Vt=[1,103],$Vu=[1,104],$Vv=[1,105],$Vw=[1,106],$Vx=[1,107],$Vy=[1,108],$Vz=[1,109],$VA=[1,110],$VB=[1,111],$VC=[1,112],$VD=[1,113],$VE=[1,114],$VF=[1,115],$VG=[1,116],$VH=[1,117],$VI=[1,119],$VJ=[1,120],$VK=[1,121],$VL=[1,122],$VM=[1,135],$VN=[1,136],$VO=[1,137],$VP=[1,138],$VQ=[1,139],$VR=[1,140],$VS=[9,18,27,53,54,55,56,57],$VT=[9,18,27,53,54],$VU=[9,18,27,53,54,55],parser={trace:function(){},yy:{},symbols_:{error:2,program:3,CLASS:4,PROG:5,BEGIN:6,def_list:7,"(":8,")":9,block:10,END:11,EOF:12,import_list:13,expr_list:14,import:15,IMPORT:16,package:17,";":18,VAR:19,".":20,"*":21,def:22,funct_type:23,var:24,paramList:25,param:26,",":27,DEF:28,INT:29,BOOL:30,expr:31,FORWARD:32,LEFT:33,PICKBUZZER:34,LEAVEBUZZER:35,HALT:36,CONTINUE:37,BREAK:38,return:39,call:40,cond:41,loop:42,repeat:43,RET:44,term:45,int_termList:46,IF:47,bool_term:48,ELSE:49,WHILE:50,REPEAT:51,int_term:52,OR:53,AND:54,"==":55,"<":56,"<=":57,NOT:58,clause:59,IFZ:60,bool_fun:61,integer:62,IFNFWALL:63,IFFWALL:64,IFNLWALL:65,IFLWALL:66,IFNRWALL:67,IFRWALL:68,IFWBUZZER:69,IFNWBUZZER:70,IFBBUZZER:71,IFNBBUZZER:72,IFW:73,IFN:74,IFE:75,IFS:76,IFNW:77,IFNN:78,IFNE:79,IFNS:80,int_literal:81,INC:82,DEC:83,NUM:84,$accept:0,$end:1},terminals_:{2:"error",4:"CLASS",5:"PROG",6:"BEGIN",8:"(",9:")",11:"END",12:"EOF",16:"IMPORT",18:";",19:"VAR",20:".",21:"*",27:",",28:"DEF",29:"INT",30:"BOOL",32:"FORWARD",33:"LEFT",34:"PICKBUZZER",35:"LEAVEBUZZER",36:"HALT",37:"CONTINUE",38:"BREAK",44:"RET",47:"IF",49:"ELSE",50:"WHILE",51:"REPEAT",53:"OR",54:"AND",55:"==",56:"<",57:"<=",58:"NOT",60:"IFZ",63:"IFNFWALL",64:"IFFWALL",65:"IFNLWALL",66:"IFLWALL",67:"IFNRWALL",68:"IFRWALL",69:"IFWBUZZER",70:"IFNWBUZZER",71:"IFBBUZZER",72:"IFNBBUZZER",73:"IFW",74:"IFN",75:"IFE",76:"IFS",77:"IFNW",78:"IFNN",79:"IFNE",80:"IFNS",82:"INC",83:"DEC",84:"NUM"},productions_:[0,[3,10],[3,9],[3,11],[3,10],[10,3],[13,2],[13,1],[15,3],[17,3],[17,3],[7,2],[7,1],[22,5],[22,6],[25,3],[25,1],[26,1],[23,1],[23,1],[23,1],[14,2],[14,0],[31,4],[31,4],[31,4],[31,4],[31,4],[31,2],[31,2],[31,2],[31,2],[31,1],[31,1],[31,1],[31,1],[31,1],[39,3],[39,1],[39,2],[40,3],[40,4],[46,3],[46,1],[41,5],[41,7],[42,5],[43,5],[45,3],[45,3],[45,3],[45,3],[45,3],[45,2],[45,3],[45,1],[48,1],[52,1],[59,4],[59,1],[59,3],[59,1],[59,1],[59,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[61,1],[62,1],[62,4],[62,4],[62,6],[62,6],[81,1],[24,1]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return resetCompiler(),{compiler:COMPILER,language:LANG,variablesCanBeFunctions:VarsAsFuncs,requieresFunctionPrototypes:reqsPrototypes,packages:[],functions:$$[$0-6],program:$$[$0-2].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 2:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:[],functions:[],program:$$[$0-2].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 3:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:$$[$0-10],functions:$$[$0-6],program:$$[$0-2].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 4:return resetCompiler(),{compiler:COMPILER,language:LANG,packages:$$[$0-9],requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,functions:[],program:$$[$0-2].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 5:case 30:case 31:this.$=$$[$0-1];break;case 6:case 11:case 21:this.$=$$[$0-1].concat($$[$0]);break;case 7:case 12:case 16:case 32:case 33:case 34:case 35:case 55:this.$=$$[$0];break;case 8:this.$=[[$$[$0-1],_$[$0-1]]];break;case 9:this.$=$$[$0-2]+"."+$$[$0];break;case 10:this.$=$$[$0-2]+".*";break;case 13:this._$.first_line=_$[$0-4].first_line,this._$.first_column=_$[$0-4].first_column,this._$.last_line=_$[$0-2].last_line,this._$.last_column=_$[$0-2].last_column,this.$=[{name:$$[$0-3],code:[locToIR(_$[$0-3]),...$$[$0],["RET","__DEFAULT",{first_line:_$[$0].last_line,first_column:_$[$0].last_column-1,last_line:_$[$0].last_line,last_column:_$[$0].last_column}]],params:[],loc:this._$,returnType:$$[$0-4]}];break;case 14:this._$.first_line=_$[$0-5].first_line,this._$.first_column=_$[$0-5].first_column,this._$.last_line=_$[$0-3].last_line,this._$.last_column=_$[$0-3].last_column;let result=[locToIR(_$[$0-4]),...$$[$0],["RET","__DEFAULT",{first_line:_$[$0].last_line,first_column:_$[$0].last_column-1,last_line:_$[$0].last_line,last_column:_$[$0].last_column}]];$$[$0-1],this.$=[{name:$$[$0-4],code:result,params:$$[$0-2],loc:this._$,returnType:$$[$0-5]}];break;case 15:this.$=$$[$0-2].concat($$[$0]);break;case 17:this.$=[{name:$$[$0],loc:_$[$0]}];break;case 18:this.$="VOID";break;case 19:this.$="INT";break;case 20:this.$="BOOL";break;case 22:case 36:this.$=[];break;case 23:this.$=[locToIR(_$[$0-3]),["FORWARD"]];break;case 24:this.$=[locToIR(_$[$0-3]),["LEFT"]];break;case 25:this.$=[locToIR(_$[$0-3]),["PICKBUZZER"]];break;case 26:this.$=[locToIR(_$[$0-3]),["LEAVEBUZZER"]];break;case 27:this.$=[locToIR(_$[$0-3]),["HALT"]];break;case 28:this.$=[locToIR(_$[$0-1]),["CONTINUE",_$[$0-1]]];break;case 29:this.$=[locToIR(_$[$0-1]),["BREAK",_$[$0-1]]];break;case 37:this.$=[["RET",{term:{operation:"ATOM",instructions:[["LOAD",0]],dataType:"VOID",atomType:"IMPLICIT.0"},loc:_$[$0-2]}]];break;case 38:this.$=[["RET",{term:{operation:"ATOM",instructions:[["LOAD",0]],dataType:"VOID",atomType:"IMPLICIT.0"},loc:_$[$0]}]];break;case 39:this.$=[["RET",{term:$$[$0],loc:_$[$0-1]}]];break;case 40:var loc={first_line:_$[$0-1].first_line,first_column:_$[$0-1].first_column,last_line:_$[$0].last_line,last_column:_$[$0].last_column};this.$=[["CALL",{target:$$[$0-2],params:[],nameLoc:_$[$0-2],argLoc:loc}]];break;case 41:this._$.first_column=_$[$0-3].first_column,this._$.first_line=_$[$0-3].first_line,this._$.last_column=_$[$0].last_column,this._$.last_line=_$[$0].last_line,this.$=[["CALL",{target:$$[$0-3],params:$$[$0-1],nameLoc:_$[$0-3],argLoc:loc}]];break;case 42:this.$=$$[$0-2].concat([{term:$$[$0],operation:"PASS",dataType:"INT",loc:$$[$0].loc,totalLoc:$$[$0].totalLoc}]);break;case 43:this.$=[{term:$$[$0],operation:"PASS",dataType:"INT",loc:$$[$0].loc,totalLoc:$$[$0].totalLoc}];break;case 44:const skipTag=UniqueTag("iskip");this.$=[["IF",{condition:$$[$0-2][0],line:locToIR(_$[$0-4]),skipTrueTag:skipTag,trueCase:$$[$0]}]];break;case 45:const toElse=UniqueTag("ielse"),skipElse=UniqueTag("iskipelse");this.$=[["IF",{condition:$$[$0-4][0],line:locToIR(_$[$0-6]),skipTrueTag:toElse,skipFalseTag:skipElse,trueCase:$$[$0-2],falseCase:$$[$0]}]];break;case 46:const repeatTag=UniqueTag("lrepeat"),endTag=UniqueTag("lend");this.$=[["WHILE",{condition:$$[$0-2][0],line:locToIR(_$[$0-4]),repeatTag:repeatTag,endTag:endTag,instructions:$$[$0]}]];break;case 47:const repeatEnd=UniqueTag("rend"),repeatLoop=UniqueTag("rloop"),continueLoop=UniqueTag("rcontinue");this.$=[["REPEAT",{line:locToIR(_$[$0-4]),loopCount:$$[$0-2][0],repeatTag:repeatLoop,continueTag:continueLoop,endTag:repeatEnd,instructions:$$[$0]}]];break;case 48:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={left:$$[$0-2],right:$$[$0],operation:"OR",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 49:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={left:$$[$0-2],right:$$[$0],operation:"AND",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 50:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={left:$$[$0-2],right:$$[$0],operation:"EQ",loc:_$[$0-1],totalLoc:this._$,dataType:"BOOL"};break;case 51:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={left:$$[$0-2],right:$$[$0],operation:"LT",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 52:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={left:$$[$0-2],right:$$[$0],operation:"LTE",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 53:this._$=mergeLocs(_$[$0-1],_$[$0]),this.$={term:$$[$0],operation:"NOT",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 54:this.$={term:$$[$0-1],operation:"PARENTHESIS",dataType:$$[$0-1].dataType,loc:$$[$0-1].loc,totalLoc:this._$};break;case 56:this.$=[["TERM",{term:$$[$0],operation:"PASS",dataType:"BOOL",loc:$$[$0].loc,totalLoc:$$[$0].totalLoc}]];break;case 57:this.$=[["TERM",{term:$$[$0],operation:"PASS",dataType:"INT",loc:$$[$0].loc,totalLoc:$$[$0].totalLoc}]];break;case 58:this._$=mergeLocs(_$[$0-3],_$[$0]),this.$={operation:"ATOM",instructions:$$[$0-1].concat([["NOT"]]),dataType:"BOOL",atomType:"IS_ZERO",loc:_$[$0-3],totalLoc:this._$};break;case 59:this._$=_$[$0],this.$={operation:"ATOM",instructions:$$[$0].code,atomType:$$[$0].name,dataType:"BOOL",loc:this._$,totalLoc:this._$};break;case 60:this._$=mergeLocs(_$[$0-2],_$[$0]),this.$={operation:"ATOM",instructions:$$[$0-2].code,atomType:$$[$0-2].name,dataType:"BOOL",loc:_$[$0-2],totalLoc:this._$};break;case 61:this._$=_$[$0],this.$={operation:"ATOM",instructions:$$[$0].code,atomType:$$[$0].data,dataType:"INT",loc:_$[$0],totalLoc:_$[$0]};break;case 62:const callIR=$$[$0],callData=callIR[0][1];this.$={operation:"ATOM",instructions:[...callIR,["LRET"]],dataType:"$"+callData.target,atomType:"CALL",loc:_$[$0],totalLoc:_$[$0]};break;case 63:const ir=[["VAR",{target:$$[$0],loc:_$[$0],couldBeFunction:!1}]];this._$=_$[$0],this.$={operation:"ATOM",instructions:ir,dataType:"$"+$$[$0],atomType:`VAR.${$$[$0]}`,loc:_$[$0],totalLoc:_$[$0]};break;case 64:this.$={name:"IFNFWALL",code:[["WORLDWALLS"],["ORIENTATION"],["MASK"],["AND"],["NOT"]]};break;case 65:this.$={name:"IFFWALL",code:[["WORLDWALLS"],["ORIENTATION"],["MASK"],["AND"]]};break;case 66:this.$={name:"IFNLWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTL"],["MASK"],["AND"],["NOT"]]};break;case 67:this.$={name:"IFLWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTL"],["MASK"],["AND"]]};break;case 68:this.$={name:"IFNRWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTR"],["MASK"],["AND"],["NOT"]]};break;case 69:this.$={name:"IFRWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTR"],["MASK"],["AND"]]};break;case 70:this.$={name:"IFWBUZZER",code:[["WORLDBUZZERS"],["LOAD",0],["EQ"],["NOT"]]};break;case 71:this.$={name:"IFNWBUZZER",code:[["WORLDBUZZERS"],["NOT"]]};break;case 72:this.$={name:"IFBBUZZER",code:[["BAGBUZZERS"],["LOAD",0],["EQ"],["NOT"]]};break;case 73:this.$={name:"IFNBBUZZER",code:[["BAGBUZZERS"],["NOT"]]};break;case 74:this.$={name:"IFW",code:[["ORIENTATION"],["LOAD",0],["EQ"]]};break;case 75:this.$={name:"IFN",code:[["ORIENTATION"],["LOAD",1],["EQ"]]};break;case 76:this.$={name:"IFE",code:[["ORIENTATION"],["LOAD",2],["EQ"]]};break;case 77:this.$={name:"IFS",code:[["ORIENTATION"],["LOAD",3],["EQ"]]};break;case 78:this.$={name:"IFNW",code:[["ORIENTATION"],["LOAD",0],["EQ"],["NOT"]]};break;case 79:this.$={name:"IFNN",code:[["ORIENTATION"],["LOAD",1],["EQ"],["NOT"]]};break;case 80:this.$={name:"IFNE",code:[["ORIENTATION"],["LOAD",2],["EQ"],["NOT"]]};break;case 81:this.$={name:"IFNS",code:[["ORIENTATION"],["LOAD",3],["EQ"],["NOT"]]};break;case 82:this.$={data:`NUMBER.${$$[$0]}`,code:[["LOAD",$$[$0]]]};break;case 83:this.$={data:"INC",code:$$[$0-1].concat([["INC",1]])};break;case 84:this.$={data:"DEC",code:$$[$0-1].concat([["DEC",1]])};break;case 85:this.$={data:`INC.${$$[$0-1]}`,code:$$[$0-3].concat([["INC",$$[$0-1]]])};break;case 86:this.$={data:`DEC.${$$[$0-1]}`,code:$$[$0-3].concat([["DEC",$$[$0-1]]])};break;case 87:this.$=parseInt(yytext);break;case 88:this.$=yytext}},table:[{3:1,4:[1,2],13:3,15:4,16:$V0},{1:[3]},{5:[1,6]},{4:[1,7],15:8,16:$V0},o($V1,[2,7]),{17:9,19:[1,10]},{6:[1,11]},{5:[1,12]},o($V1,[2,6]),{18:[1,13]},{20:[1,14]},{5:[1,16],7:15,22:17,23:18,28:$V2,29:$V3,30:$V4},{6:[1,22]},o($V1,[2,8]),{19:[1,23],21:[1,24]},{5:[1,25],22:26,23:18,28:$V2,29:$V3,30:$V4},{8:[1,27]},o($V5,[2,12]),{19:$V6,24:28},{19:[2,18]},{19:[2,19]},{19:[2,20]},{5:[1,31],7:30,22:17,23:18,28:$V2,29:$V3,30:$V4},{18:[2,9]},{18:[2,10]},{8:[1,32]},o($V5,[2,11]),{9:[1,33]},{8:[1,34]},o($V7,[2,88]),{5:[1,35],22:26,23:18,28:$V2,29:$V3,30:$V4},{8:[1,36]},{9:[1,37]},{6:$V8,10:38},{9:[1,40],19:$V6,24:43,25:41,26:42},{8:[1,44]},{9:[1,45]},{6:$V8,10:46},{11:[1,47]},o($V9,[2,22],{14:48}),{6:$V8,10:49},{9:[1,50]},{9:[2,16],27:[1,51]},o($Va,[2,17]),{9:[1,52]},{6:$V8,10:53},{11:[1,54]},{12:[1,55]},{6:$V8,10:70,11:[1,56],18:$Vb,19:$V6,24:73,31:57,32:$Vc,33:$Vd,34:$Ve,35:$Vf,36:$Vg,37:$Vh,38:$Vi,39:65,40:66,41:67,42:68,43:69,44:$Vj,47:$Vk,50:$Vl,51:$Vm},o($V5,[2,13]),{6:$V8,10:77},{19:$V6,24:43,25:78,26:42},{6:$V8,10:79},{11:[1,80]},{12:[1,81]},{1:[2,2]},o([5,6,11,18,19,28,29,30,32,33,34,35,36,37,38,44,47,49,50,51],[2,5]),o($V9,[2,21]),{8:[1,82]},{8:[1,83]},{8:[1,84]},{8:[1,85]},{8:[1,86]},{18:[1,87]},{18:[1,88]},{18:[1,89]},{18:[1,90]},o($Vn,[2,32]),o($Vn,[2,33]),o($Vn,[2,34]),o($Vn,[2,35]),o($Vn,[2,36]),{8:[1,91],18:[2,38],19:$V6,24:99,40:98,45:92,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VL},{8:[1,123]},{8:[1,124]},{8:[1,125]},o($V5,[2,14]),{9:[2,15]},{11:[1,126]},{12:[1,127]},{1:[2,1]},{9:[1,128]},{9:[1,129]},{9:[1,130]},{9:[1,131]},{9:[1,132]},o($Vn,[2,28]),o($Vn,[2,29]),o($Vn,[2,30]),o($Vn,[2,31]),{8:$VM,9:[1,133],19:$V6,24:99,40:98,45:134,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{18:[2,39],53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR},{8:$VM,19:$V6,24:99,40:98,45:141,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},o($VS,[2,55]),{8:[1,142]},o($VS,[2,59],{8:[1,143]}),o($VS,[2,61]),o($VS,[2,62]),o($VS,[2,63],{8:$VL}),o($V7,[2,64]),o($V7,[2,65]),o($V7,[2,66]),o($V7,[2,67]),o($V7,[2,68]),o($V7,[2,69]),o($V7,[2,70]),o($V7,[2,71]),o($V7,[2,72]),o($V7,[2,73]),o($V7,[2,74]),o($V7,[2,75]),o($V7,[2,76]),o($V7,[2,77]),o($V7,[2,78]),o($V7,[2,79]),o($V7,[2,80]),o($V7,[2,81]),o($VS,[2,82]),{8:[1,144]},{8:[1,145]},o($VS,[2,87]),{8:$VM,9:[1,146],19:$V6,24:99,40:98,45:148,46:147,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:150,48:149,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:150,48:151,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:153,52:152,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{12:[1,154]},{1:[2,4]},{18:[1,155]},{18:[1,156]},{18:[1,157]},{18:[1,158]},{18:[1,159]},{18:[2,37]},{9:[1,160],53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR},{8:$VM,19:$V6,24:99,40:98,45:134,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:161,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:162,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:163,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:164,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:165,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},o($VS,[2,53]),{8:$VM,19:$V6,24:99,40:98,45:153,52:166,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{9:[1,167]},{8:$VM,19:$V6,24:99,40:98,45:153,52:168,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{8:$VM,19:$V6,24:99,40:98,45:153,52:169,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},o($VS,[2,40]),{9:[1,170],27:[1,171]},o($Va,[2,43],{53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR}),{9:[1,172]},{9:[2,56],53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR},{9:[1,173]},{9:[1,174]},o($Va,[2,57],{53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR}),{1:[2,3]},o($Vn,[2,23]),o($Vn,[2,24]),o($Vn,[2,25]),o($Vn,[2,26]),o($Vn,[2,27]),o($VS,[2,54]),o([9,18,27,53],[2,48],{54:$VO,55:$VP,56:$VQ,57:$VR}),o($VT,[2,49],{55:$VP,56:$VQ,57:$VR}),o($VT,[2,50],{56:$VQ,57:$VR}),o($VU,[2,51]),o($VU,[2,52]),{9:[1,175]},o($VS,[2,60]),{9:[1,176],27:[1,177]},{9:[1,178],27:[1,179]},o($VS,[2,41]),{8:$VM,19:$V6,24:99,40:98,45:180,58:$Vo,59:94,60:$Vp,61:96,62:97,63:$Vq,64:$Vr,65:$Vs,66:$Vt,67:$Vu,68:$Vv,69:$Vw,70:$Vx,71:$Vy,72:$Vz,73:$VA,74:$VB,75:$VC,76:$VD,77:$VE,78:$VF,79:$VG,80:$VH,81:118,82:$VI,83:$VJ,84:$VK},{6:$V8,10:70,18:$Vb,19:$V6,24:73,31:181,32:$Vc,33:$Vd,34:$Ve,35:$Vf,36:$Vg,37:$Vh,38:$Vi,39:65,40:66,41:67,42:68,43:69,44:$Vj,47:$Vk,50:$Vl,51:$Vm},{6:$V8,10:70,18:$Vb,19:$V6,24:73,31:182,32:$Vc,33:$Vd,34:$Ve,35:$Vf,36:$Vg,37:$Vh,38:$Vi,39:65,40:66,41:67,42:68,43:69,44:$Vj,47:$Vk,50:$Vl,51:$Vm},{6:$V8,10:70,18:$Vb,19:$V6,24:73,31:183,32:$Vc,33:$Vd,34:$Ve,35:$Vf,36:$Vg,37:$Vh,38:$Vi,39:65,40:66,41:67,42:68,43:69,44:$Vj,47:$Vk,50:$Vl,51:$Vm},o($VS,[2,58]),o($VS,[2,83]),{81:184,84:$VK},o($VS,[2,84]),{81:185,84:$VK},o($Va,[2,42],{53:$VN,54:$VO,55:$VP,56:$VQ,57:$VR}),o($V9,[2,44],{49:[1,186]}),o($Vn,[2,46]),o($Vn,[2,47]),{9:[1,187]},{9:[1,188]},{6:$V8,10:70,18:$Vb,19:$V6,24:73,31:189,32:$Vc,33:$Vd,34:$Ve,35:$Vf,36:$Vg,37:$Vh,38:$Vi,39:65,40:66,41:67,42:68,43:69,44:$Vj,47:$Vk,50:$Vl,51:$Vm},o($VS,[2,85]),o($VS,[2,86]),o($Vn,[2,45])],defaultActions:{19:[2,18],20:[2,19],21:[2,20],23:[2,9],24:[2,10],55:[2,2],78:[2,15],81:[2,1],127:[2,4],133:[2,37],154:[2,3]},parseError:function(str,hash){if(!hash.recoverable){var error=new Error(str);throw error.hash=hash,error}this.trace(str)},parse:function(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,args=lstack.slice.call(arguments,1),lexer=Object.create(this.lexer),sharedState={yy:{}};for(var k in this.yy)Object.prototype.hasOwnProperty.call(this.yy,k)&&(sharedState.yy[k]=this.yy[k]);lexer.setInput(input,sharedState.yy),sharedState.yy.lexer=lexer,sharedState.yy.parser=this,void 0===lexer.yylloc&&(lexer.yylloc={});var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;"function"==typeof sharedState.yy.parseError?this.parseError=sharedState.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var symbol,state,action,r,p,len,newState,expected,token,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:(null==symbol&&(token=void 0,"number"!=typeof(token=lexer.lex()||1)&&(token=self.symbols_[token]||token),symbol=token),action=table[state]&&table[state][symbol]),void 0===action||!action.length||!action[0]){var errStr="";for(p in expected=[],table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:lexer.yylloc,expected:expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(lexer.yytext),lstack.push(lexer.yylloc),stack.push(action[1]),symbol=null,yyleng=lexer.yyleng,yytext=lexer.yytext,yylineno=lexer.yylineno,yyloc=lexer.yylloc;break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args))))return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}};const COMPILER="RKJ 1.0.0",LANG="ReKarel Java",VarsAsFuncs=!1,reqsPrototypes=!1;let tagCnt=1;function UniqueTag(tag){return`${tag}.${tagCnt++}`}function resetCompiler(tag){tagCnt=1}function mergeLocs(first,second){return{first_line:first.first_line,first_column:first.first_column,last_line:second.last_line,last_column:second.last_column}}function locToIR(loc){return["LINE",loc.first_line-1,loc.first_column]}var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input,yy){return this.yy=yy||this.yy||{},this._input=input,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];return this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch,ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer&&(backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))),(lines=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;var token,match,tempMatch,index;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length;i++)if((tempMatch=this._input.match(this.rules[rules[i]]))&&(!match||tempMatch[0].length>match[0].length)){if(match=tempMatch,index=i,this.options.backtrack_lexer){if(!1!==(token=this.test_match(tempMatch,rules[i])))return token;if(this._backtrack){match=!1;continue}return!1}if(!this.options.flex)break}return match?!1!==(token=this.test_match(match,rules[index]))&&token:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return r||this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(n){return(n=this.conditionStack.length-1-Math.abs(n||0))>=0?this.conditionStack[n]:"INITIAL"},pushState:function(condition){this.begin(condition)},stateStackSize:function(){return this.conditionStack.length},options:{},performAction:function(yy,yy_,$avoiding_name_collisions,YY_START){switch($avoiding_name_collisions){case 0:case 1:case 2:break;case 3:return 4;case 4:return 5;case 5:case 7:return 28;case 6:return 16;case 8:return 29;case 9:return 30;case 10:return 44;case 11:return 36;case 12:return 33;case 13:return 32;case 14:return 34;case 15:return 35;case 16:return 37;case 17:return 38;case 18:return 50;case 19:return 51;case 20:return 83;case 21:return 82;case 22:return 60;case 23:return 63;case 24:return 64;case 25:return 65;case 26:return 66;case 27:return 67;case 28:return 68;case 29:return 69;case 30:return 70;case 31:return 71;case 32:return 72;case 33:return 74;case 34:return 76;case 35:return 75;case 36:return 73;case 37:return 78;case 38:return 80;case 39:return 79;case 40:return 77;case 41:return 49;case 42:return 47;case 43:return 58;case 44:return 53;case 45:case 46:return 54;case 47:return 8;case 48:return 9;case 49:return 6;case 50:return 11;case 51:return 18;case 52:return 20;case 53:return 21;case 54:return 27;case 55:return 55;case 56:return 57;case 57:return 56;case 58:return 84;case 59:return 19;case 60:return 12}},rules:[/^(?:\s+)/,/^(?:\/\/[^\n]*)/,/^(?:\/\*(?:[^*]|\*(?!\/))*\*\/)/,/^(?:class\b)/,/^(?:program\b)/,/^(?:define\b)/,/^(?:import\b)/,/^(?:void\b)/,/^(?:int\b)/,/^(?:bool\b)/,/^(?:return\b)/,/^(?:turnoff\b)/,/^(?:turnleft\b)/,/^(?:move\b)/,/^(?:pickbeeper\b)/,/^(?:putbeeper\b)/,/^(?:continue\b)/,/^(?:break\b)/,/^(?:while\b)/,/^(?:iterate\b)/,/^(?:pred\b)/,/^(?:succ\b)/,/^(?:iszero\b)/,/^(?:frontIsClear\b)/,/^(?:frontIsBlocked\b)/,/^(?:leftIsClear\b)/,/^(?:leftIsBlocked\b)/,/^(?:rightIsClear\b)/,/^(?:rightIsBlocked\b)/,/^(?:nextToABeeper\b)/,/^(?:notNextToABeeper\b)/,/^(?:anyBeepersInBeeperBag\b)/,/^(?:noBeepersInBeeperBag\b)/,/^(?:facingNorth\b)/,/^(?:facingSouth\b)/,/^(?:facingEast\b)/,/^(?:facingWest\b)/,/^(?:notFacingNorth\b)/,/^(?:notFacingSouth\b)/,/^(?:notFacingEast\b)/,/^(?:notFacingWest\b)/,/^(?:else\b)/,/^(?:if\b)/,/^(?:!)/,/^(?:\|\|)/,/^(?:&&)/,/^(?:&)/,/^(?:\()/,/^(?:\))/,/^(?:\{)/,/^(?:\})/,/^(?:;)/,/^(?:\.)/,/^(?:\*)/,/^(?:,)/,/^(?:==)/,/^(?:<=)/,/^(?:<)/,/^(?:[0-9]+)/,/^(?:[A-Za-zÀ-ÖØ-öø-ÿ_][A-Za-zÀ-ÖØ-öø-ÿ0-9_-]*)/,/^(?:$)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],inclusive:!0}}};function Parser(){this.yy={}}return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}();var karelpascal=function(){var o=function(k,v,o,l){for(o=o||{},l=k.length;l--;o[k[l]]=v);return o},$V0=[1,5],$V1=[1,16],$V2=[1,17],$V3=[1,18],$V4=[1,13],$V5=[1,14],$V6=[1,15],$V7=[5,13],$V8=[9,15],$V9=[2,28],$Va=[1,47],$Vb=[1,28],$Vc=[1,29],$Vd=[1,30],$Ve=[1,31],$Vf=[1,32],$Vg=[1,33],$Vh=[1,34],$Vi=[1,40],$Vj=[1,41],$Vk=[1,44],$Vl=[1,45],$Vm=[1,46],$Vn=[1,58],$Vo=[9,15,50],$Vp=[9,15,50,58],$Vq=[1,62],$Vr=[1,61],$Vs=[1,64],$Vt=[1,69],$Vu=[1,70],$Vv=[1,71],$Vw=[1,72],$Vx=[1,73],$Vy=[1,74],$Vz=[1,75],$VA=[1,76],$VB=[1,77],$VC=[1,78],$VD=[1,79],$VE=[1,80],$VF=[1,81],$VG=[1,82],$VH=[1,83],$VI=[1,84],$VJ=[1,85],$VK=[1,86],$VL=[1,88],$VM=[1,89],$VN=[1,90],$VO=[1,91],$VP=[7,30,31,32,33,34,35],$VQ=[1,108],$VR=[1,109],$VS=[1,110],$VT=[1,111],$VU=[1,112],$VV=[9,15,24,29,50,57,58,60,63,64,65,66,67,68],$VW=[24,29],$VX=[9,15,24,29,50,57,58,60,63,64,65],$VY=[9,15,24,29,50,57,58,60,63,64,65,66],parser={trace:function(){},yy:{},symbols_:{error:2,program:3,import_list:4,BEGINPROG:5,def_list:6,BEGINEXEC:7,expr_list:8,ENDEXEC:9,ENDPROG:10,EOF:11,import:12,IMPORT:13,package:14,";":15,VAR:16,".":17,"*":18,def:19,prototype_type:20,var:21,"(":22,paramList:23,")":24,funct_type:25,AS:26,expr:27,param:28,",":29,DEF_INT:30,DEF_BOOL:31,DEF:32,PROTO_INT:33,PROTO_BOOL:34,PROTO:35,genexpr:36,FORWARD:37,LEFT:38,PICKBUZZER:39,LEAVEBUZZER:40,HALT:41,CONTINUE:42,BREAK:43,return:44,call:45,cond:46,loop:47,repeat:48,BEGIN:49,END:50,RET:51,term:52,parameteredCall:53,int_termList:54,IF:55,bool_term:56,THEN:57,ELSE:58,WHILE:59,DO:60,REPEAT:61,int_term:62,TIMES:63,OR:64,AND:65,"==":66,"<":67,"<=":68,NOT:69,clause:70,IFZ:71,bool_fun:72,integer:73,IFNFWALL:74,IFFWALL:75,IFNLWALL:76,IFLWALL:77,IFNRWALL:78,IFRWALL:79,IFWBUZZER:80,IFNWBUZZER:81,IFBBUZZER:82,IFNBBUZZER:83,IFW:84,IFN:85,IFE:86,IFS:87,IFNW:88,IFNN:89,IFNE:90,IFNS:91,int_literal:92,INC:93,DEC:94,NUM:95,$accept:0,$end:1},terminals_:{2:"error",5:"BEGINPROG",7:"BEGINEXEC",9:"ENDEXEC",10:"ENDPROG",11:"EOF",13:"IMPORT",15:";",16:"VAR",17:".",18:"*",22:"(",24:")",26:"AS",29:",",30:"DEF_INT",31:"DEF_BOOL",32:"DEF",33:"PROTO_INT",34:"PROTO_BOOL",35:"PROTO",37:"FORWARD",38:"LEFT",39:"PICKBUZZER",40:"LEAVEBUZZER",41:"HALT",42:"CONTINUE",43:"BREAK",49:"BEGIN",50:"END",51:"RET",55:"IF",57:"THEN",58:"ELSE",59:"WHILE",60:"DO",61:"REPEAT",63:"TIMES",64:"OR",65:"AND",66:"==",67:"<",68:"<=",69:"NOT",71:"IFZ",74:"IFNFWALL",75:"IFFWALL",76:"IFNLWALL",77:"IFLWALL",78:"IFNRWALL",79:"IFRWALL",80:"IFWBUZZER",81:"IFNWBUZZER",82:"IFBBUZZER",83:"IFNBBUZZER",84:"IFW",85:"IFN",86:"IFE",87:"IFS",88:"IFNW",89:"IFNN",90:"IFNE",91:"IFNS",93:"INC",94:"DEC",95:"NUM"},productions_:[0,[3,8],[3,7],[3,7],[3,6],[4,2],[4,1],[12,3],[14,3],[14,3],[6,3],[6,2],[19,2],[19,5],[19,4],[19,7],[23,3],[23,1],[28,1],[25,1],[25,1],[25,1],[20,1],[20,1],[20,1],[8,3],[8,1],[36,1],[36,0],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,1],[27,3],[44,1],[44,2],[45,1],[45,1],[53,4],[54,3],[54,1],[46,4],[46,6],[47,4],[48,4],[52,3],[52,3],[52,3],[52,3],[52,3],[52,2],[52,3],[52,1],[56,1],[62,1],[70,4],[70,1],[70,1],[70,1],[70,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[72,1],[73,1],[73,4],[73,4],[73,6],[73,6],[92,1],[21,1]],performAction:function(yytext,yyleng,yylineno,yy,yystate,$$,_$){var $0=$$.length-1;switch(yystate){case 1:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:$$[$0-7],functions:$$[$0-5],program:$$[$0-3].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 2:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:$$[$0-6],functions:[],program:$$[$0-3].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 3:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:[],functions:$$[$0-5],program:$$[$0-3].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 4:return resetCompiler(),{compiler:COMPILER,language:LANG,requieresFunctionPrototypes:reqsPrototypes,variablesCanBeFunctions:VarsAsFuncs,packages:[],functions:[],program:$$[$0-3].concat([["LINE",yylineno,0],["HALT"]]),yy:yy};case 5:this.$=$$[$0-1].concat($$[$0]);break;case 6:case 17:case 26:case 27:case 36:case 37:case 38:case 39:case 40:case 45:case 60:this.$=$$[$0];break;case 7:this.$=[[$$[$0-1],_$[$0-1]]];break;case 8:this.$=$$[$0-2]+"."+$$[$0];break;case 9:this.$=$$[$0-2]+".*";break;case 10:this.$=$$[$0-2].concat($$[$0-1]);break;case 11:case 41:this.$=$$[$0-1];break;case 12:this._$.first_line=_$[$0-1].first_line,this._$.first_column=_$[$0-1].first_column,this._$.last_line=_$[$0].last_line,this._$.last_column=_$[$0].last_column,this.$=[{name:$$[$0].toLowerCase(),code:null,params:[],loc:this._$,returnType:$$[$0-1]}];break;case 13:this._$.first_line=_$[$0-4].first_line,this._$.first_column=_$[$0-4].first_column,this._$.last_line=_$[$0].last_line,this._$.last_column=_$[$0].last_column,this.$=[{name:$$[$0-3].toLowerCase(),code:null,params:$$[$0-1],loc:this._$,returnType:$$[$0-4]}];break;case 14:this._$.first_line=_$[$0-3].first_line,this._$.first_column=_$[$0-3].first_column,this._$.last_line=_$[$0-2].last_line,this._$.last_column=_$[$0-2].last_column,this.$=[{name:$$[$0-2].toLowerCase(),code:[locToIR(_$[$0-2]),...$$[$0],["RET","__DEFAULT",{first_line:_$[$0].last_line,first_column:_$[$0].last_column,last_line:_$[$0].last_line,last_column:_$[$0].last_column}]],params:[],loc:this._$,returnType:$$[$0-3]}];break;case 15:this._$.first_line=_$[$0-6].first_line,this._$.first_column=_$[$0-6].first_column,this._$.last_line=_$[$0-5].last_line,this._$.last_column=_$[$0-5].last_column,this.$=[{name:$$[$0-5].toLowerCase(),code:[locToIR(_$[$0-5]),...$$[$0],["RET","__DEFAULT",{first_line:_$[$0].last_line,first_column:_$[$0].last_column,last_line:_$[$0].last_line,last_line:_$[$0].last_column}]],params:$$[$0-3],loc:this._$,returnType:$$[$0-6]}];break;case 16:case 25:this.$=$$[$0-2].concat($$[$0]);break;case 18:this.$=[{name:$$[$0],loc:_$[$0]}];break;case 19:case 22:this.$="INT";break;case 20:case 23:this.$="BOOL";break;case 21:case 24:this.$="VOID";break;case 28:this.$=[];break;case 29:this.$=[locToIR(_$[$0]),["FORWARD"]];break;case 30:this.$=[locToIR(_$[$0]),["LEFT"]];break;case 31:this.$=[locToIR(_$[$0]),["PICKBUZZER"]];break;case 32:this.$=[locToIR(_$[$0]),["LEAVEBUZZER"]];break;case 33:this.$=[locToIR(_$[$0]),["HALT"]];break;case 34:this.$=[locToIR(_$[$0]),["CONTINUE",_$[$0]]];break;case 35:this.$=[locToIR(_$[$0]),["BREAK",_$[$0]]];break;case 42:this.$=[["RET",{term:{operation:"ATOM",instructions:[["LOAD",0]],atomType:"IMPLICIT.0",dataType:"VOID"},loc:_$[$0]}]];break;case 43:this.$=[["RET",{term:$$[$0],loc:_$[$0-1]}]];break;case 44:this.$=[["CALL",{target:$$[$0].toLowerCase(),params:[],nameLoc:_$[$0],argLoc:_$[$0]}]];break;case 46:this.$=[["CALL",{target:$$[$0-3].toLowerCase(),params:$$[$0-1],nameLoc:_$[$0-3],argLoc:_$[$0-1]}]];break;case 47:this.$=$$[$0-2].concat([{term:$$[$0],operation:"PASS",dataType:"INT",loc:_$[$0],totalLoc:_$[$0]}]);break;case 48:this.$=[{term:$$[$0],operation:"PASS",dataType:"INT",loc:_$[$0],totalLoc:_$[$0]}];break;case 49:const skipTag=UniqueTag("iskip");this.$=[["IF",{condition:$$[$0-2][0],line:locToIR(_$[$0-3]),skipTrueTag:skipTag,trueCase:$$[$0]}]];break;case 50:const toElse=UniqueTag("ielse"),skipElse=UniqueTag("iskipelse");this.$=[["IF",{condition:$$[$0-4][0],line:locToIR(_$[$0-5]),skipTrueTag:toElse,skipFalseTag:skipElse,trueCase:$$[$0-2],falseCase:$$[$0]}]];break;case 51:const repeatTag=UniqueTag("lrepeat"),endTag=UniqueTag("lend");this.$=[["WHILE",{condition:$$[$0-2][0],line:locToIR(_$[$0-3]),repeatTag:repeatTag,endTag:endTag,instructions:$$[$0]}]];break;case 52:const repeatEnd=UniqueTag("rend"),repeatLoop=UniqueTag("rloop"),continueLoop=UniqueTag("rcontinue");this.$=[["REPEAT",{line:locToIR(_$[$0-3]),loopCount:$$[$0-2][0],repeatTag:repeatLoop,endTag:repeatEnd,continueTag:continueLoop,instructions:$$[$0]}]];break;case 53:this.$={left:$$[$0-2],right:$$[$0],operation:"OR",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 54:this.$={left:$$[$0-2],right:$$[$0],operation:"AND",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 55:this.$={left:$$[$0-2],right:$$[$0],operation:"EQ",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 56:this.$={left:$$[$0-2],right:$$[$0],operation:"LT",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 57:this.$={left:$$[$0-2],right:$$[$0],operation:"LTE",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 58:this.$={term:$$[$0],operation:"NOT",dataType:"BOOL",loc:_$[$0-1],totalLoc:this._$};break;case 59:this.$={term:$$[$0-1],operation:"PARENTHESIS",dataType:$$[$0-1].dataType,loc:$$[$0-1].loc,totalLoc:this._$};break;case 61:this.$=[["TERM",{term:$$[$0],operation:"PASS",dataType:"BOOL",loc:_$[$0],totalLoc:_$[$0]}]];break;case 62:this.$=[["TERM",{term:$$[$0],operation:"PASS",dataType:"INT",loc:_$[$0],totalLoc:_$[$0]}]];break;case 63:this.$={operation:"ATOM",instructions:$$[$0-1].concat([["NOT"]]),dataType:"BOOL",atomType:"IS_ZERO",loc:_$[$0-3],totalLoc:this._$};break;case 64:this.$={operation:"ATOM",instructions:$$[$0].code,atomType:$$[$0].name,dataType:"BOOL",loc:_$[$0],totalLoc:_$[$0]};break;case 65:this.$={operation:"ATOM",instructions:$$[$0].code,atomType:$$[$0].data,dataType:"INT",loc:_$[$0],totalLoc:_$[$0]};break;case 66:const ir=[["VAR",{target:$$[$0].toLowerCase(),loc:_$[$0],couldBeFunction:!0}]];this.$={operation:"ATOM",instructions:ir,dataType:"$"+$$[$0].toLowerCase(),atomType:`VAR.${$$[$0].toLowerCase()}`,loc:_$[$0],totalLoc:_$[$0]};break;case 67:const callIR=$$[$0],callData=callIR[0][1];this.$={operation:"ATOM",instructions:[...callIR,["LRET"]],dataType:"$"+callData.target,atomType:"CALL",loc:_$[$0],totalLoc:_$[$0]};break;case 68:this.$={name:"IFNFWALL",code:[["WORLDWALLS"],["ORIENTATION"],["MASK"],["AND"],["NOT"]]};break;case 69:this.$={name:"IFFWALL",code:[["WORLDWALLS"],["ORIENTATION"],["MASK"],["AND"]]};break;case 70:this.$={name:"IFNLWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTL"],["MASK"],["AND"],["NOT"]]};break;case 71:this.$={name:"IFLWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTL"],["MASK"],["AND"]]};break;case 72:this.$={name:"IFNRWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTR"],["MASK"],["AND"],["NOT"]]};break;case 73:this.$={name:"IFRWALL",code:[["WORLDWALLS"],["ORIENTATION"],["ROTR"],["MASK"],["AND"]]};break;case 74:this.$={name:"IFWBUZZER",code:[["WORLDBUZZERS"],["LOAD",0],["EQ"],["NOT"]]};break;case 75:this.$={name:"IFNWBUZZER",code:[["WORLDBUZZERS"],["NOT"]]};break;case 76:this.$={name:"IFBBUZZER",code:[["BAGBUZZERS"],["LOAD",0],["EQ"],["NOT"]]};break;case 77:this.$={name:"IFNBBUZZER",code:[["BAGBUZZERS"],["NOT"]]};break;case 78:this.$={name:"IFW",code:[["ORIENTATION"],["LOAD",0],["EQ"]]};break;case 79:this.$={name:"IFN",code:[["ORIENTATION"],["LOAD",1],["EQ"]]};break;case 80:this.$={name:"IFE",code:[["ORIENTATION"],["LOAD",2],["EQ"]]};break;case 81:this.$={name:"IFS",code:[["ORIENTATION"],["LOAD",3],["EQ"]]};break;case 82:this.$={name:"IFNW",code:[["ORIENTATION"],["LOAD",0],["EQ"],["NOT"]]};break;case 83:this.$={name:"IFNN",code:[["ORIENTATION"],["LOAD",1],["EQ"],["NOT"]]};break;case 84:this.$={name:"IFNE",code:[["ORIENTATION"],["LOAD",2],["EQ"],["NOT"]]};break;case 85:this.$={name:"IFNS",code:[["ORIENTATION"],["LOAD",3],["EQ"],["NOT"]]};break;case 86:this.$={data:`NUMBER.${$$[$0]}`,code:[["LOAD",$$[$0]]]};break;case 87:this.$={data:"INC",code:$$[$0-1].concat([["INC",1]])};break;case 88:this.$={data:"DEC",code:$$[$0-1].concat([["DEC",1]])};break;case 89:this.$={data:`INC.${$$[$0-1]}`,code:$$[$0-3].concat([["INC",$$[$0-1]]])};break;case 90:this.$={data:`DEC.${$$[$0-1]}`,code:$$[$0-3].concat([["DEC",$$[$0-1]]])};break;case 91:this.$=parseInt(yytext);break;case 92:this.$=yytext}},table:[{3:1,4:2,5:[1,3],12:4,13:$V0},{1:[3]},{5:[1,6],12:7,13:$V0},{6:8,7:[1,9],19:10,20:11,25:12,30:$V1,31:$V2,32:$V3,33:$V4,34:$V5,35:$V6},o($V7,[2,6]),{14:19,16:[1,20]},{6:21,7:[1,22],19:10,20:11,25:12,30:$V1,31:$V2,32:$V3,33:$V4,34:$V5,35:$V6},o($V7,[2,5]),{7:[1,23],19:24,20:11,25:12,30:$V1,31:$V2,32:$V3,33:$V4,34:$V5,35:$V6},o($V8,$V9,{8:25,36:26,27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),{15:[1,48]},{16:$Va,21:49},{16:$Va,21:50},{16:[2,22]},{16:[2,23]},{16:[2,24]},{16:[2,19]},{16:[2,20]},{16:[2,21]},{15:[1,51]},{17:[1,52]},{7:[1,53],19:24,20:11,25:12,30:$V1,31:$V2,32:$V3,33:$V4,34:$V5,35:$V6},o($V8,$V9,{36:26,27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,8:54,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),o($V8,$V9,{36:26,27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,8:55,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),{15:[1,56]},{9:[1,57],15:$Vn},o($Vo,[2,26]),o($Vo,[2,27]),o($Vp,[2,29]),o($Vp,[2,30]),o($Vp,[2,31]),o($Vp,[2,32]),o($Vp,[2,33]),o($Vp,[2,34]),o($Vp,[2,35]),o($Vp,[2,36]),o($Vp,[2,37]),o($Vp,[2,38]),o($Vp,[2,39]),o($Vp,[2,40]),o([15,50],$V9,{36:26,27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,8:59,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),o($Vp,[2,42],{52:60,70:63,72:65,73:66,21:67,53:68,92:87,16:$Va,22:$Vq,69:$Vr,71:$Vs,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,93:$VL,94:$VM,95:$VN}),o($Vp,[2,44],{22:$VO}),o($Vp,[2,45]),{16:$Va,21:67,22:$Vq,52:93,53:68,56:92,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:93,53:68,56:94,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:96,53:68,62:95,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},o([9,15,22,24,26,29,50,57,58,60,63,64,65,66,67,68],[2,92]),o($VP,[2,11]),{15:[2,12],22:[1,97]},{22:[1,99],26:[1,98]},o($V7,[2,7]),{16:[1,100],18:[1,101]},o($V8,$V9,{36:26,27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,8:102,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),{9:[1,103],15:$Vn},{9:[1,104],15:$Vn},o($VP,[2,10]),{10:[1,105]},o($Vo,$V9,{27:27,44:35,45:36,46:37,47:38,48:39,21:42,53:43,36:106,16:$Va,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,49:$Vi,51:$Vj,55:$Vk,59:$Vl,61:$Vm}),{15:$Vn,50:[1,107]},o($Vp,[2,43],{64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU}),{16:$Va,21:67,22:$Vq,52:113,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:114,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},o($VV,[2,60]),{22:[1,115]},o($VV,[2,64]),o($VV,[2,65]),o($VV,[2,66],{22:$VO}),o($VV,[2,67]),o($VV,[2,68]),o($VV,[2,69]),o($VV,[2,70]),o($VV,[2,71]),o($VV,[2,72]),o($VV,[2,73]),o($VV,[2,74]),o($VV,[2,75]),o($VV,[2,76]),o($VV,[2,77]),o($VV,[2,78]),o($VV,[2,79]),o($VV,[2,80]),o($VV,[2,81]),o($VV,[2,82]),o($VV,[2,83]),o($VV,[2,84]),o($VV,[2,85]),o($VV,[2,86]),{22:[1,116]},{22:[1,117]},o($VV,[2,91]),{16:$Va,21:67,22:$Vq,52:119,53:68,54:118,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{57:[1,120]},o([57,60],[2,61],{64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU}),{60:[1,121]},{63:[1,122]},o([24,29,63],[2,62],{64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU}),{16:$Va,21:125,23:123,28:124},{16:$Va,21:42,27:126,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{16:$Va,21:125,23:127,28:124},{15:[2,8]},{15:[2,9]},{9:[1,128],15:$Vn},{10:[1,129]},{10:[1,130]},{11:[1,131]},o($Vo,[2,25]),o($Vp,[2,41]),{16:$Va,21:67,22:$Vq,52:132,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:133,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:134,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:135,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:136,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},o($VV,[2,58]),{24:[1,137],64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU},{16:$Va,21:67,22:$Vq,52:96,53:68,62:138,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:96,53:68,62:139,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{16:$Va,21:67,22:$Vq,52:96,53:68,62:140,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},{24:[1,141],29:[1,142]},o($VW,[2,48],{64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU}),{16:$Va,21:42,27:143,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{16:$Va,21:42,27:144,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{16:$Va,21:42,27:145,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{24:[1,146]},{24:[2,17],29:[1,147]},o($VW,[2,18]),{15:[2,14]},{24:[1,148]},{10:[1,149]},{11:[1,150]},{11:[1,151]},{1:[2,4]},o([9,15,24,29,50,57,58,60,63,64],[2,53],{65:$VR,66:$VS,67:$VT,68:$VU}),o($VX,[2,54],{66:$VS,67:$VT,68:$VU}),o($VX,[2,55],{67:$VT,68:$VU}),o($VY,[2,56]),o($VY,[2,57]),o($VV,[2,59]),{24:[1,152]},{24:[1,153],29:[1,154]},{24:[1,155],29:[1,156]},o($VV,[2,46]),{16:$Va,21:67,22:$Vq,52:157,53:68,69:$Vr,70:63,71:$Vs,72:65,73:66,74:$Vt,75:$Vu,76:$Vv,77:$Vw,78:$Vx,79:$Vy,80:$Vz,81:$VA,82:$VB,83:$VC,84:$VD,85:$VE,86:$VF,87:$VG,88:$VH,89:$VI,90:$VJ,91:$VK,92:87,93:$VL,94:$VM,95:$VN},o($Vo,[2,49],{58:[1,158]}),o($Vp,[2,51]),o($Vp,[2,52]),{15:[2,13]},{16:$Va,21:125,23:159,28:124},{26:[1,160]},{11:[1,161]},{1:[2,2]},{1:[2,3]},o($VV,[2,63]),o($VV,[2,87]),{92:162,95:$VN},o($VV,[2,88]),{92:163,95:$VN},o($VW,[2,47],{64:$VQ,65:$VR,66:$VS,67:$VT,68:$VU}),{16:$Va,21:42,27:164,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{24:[2,16]},{16:$Va,21:42,27:165,37:$Vb,38:$Vc,39:$Vd,40:$Ve,41:$Vf,42:$Vg,43:$Vh,44:35,45:36,46:37,47:38,48:39,49:$Vi,51:$Vj,53:43,55:$Vk,59:$Vl,61:$Vm},{1:[2,1]},{24:[1,166]},{24:[1,167]},o($Vp,[2,50]),{15:[2,15]},o($VV,[2,89]),o($VV,[2,90])],defaultActions:{13:[2,22],14:[2,23],15:[2,24],16:[2,19],17:[2,20],18:[2,21],100:[2,8],101:[2,9],126:[2,14],131:[2,4],146:[2,13],150:[2,2],151:[2,3],159:[2,16],161:[2,1],165:[2,15]},parseError:function(str,hash){if(!hash.recoverable){var error=new Error(str);throw error.hash=hash,error}this.trace(str)},parse:function(input){var self=this,stack=[0],vstack=[null],lstack=[],table=this.table,yytext="",yylineno=0,yyleng=0,args=lstack.slice.call(arguments,1),lexer=Object.create(this.lexer),sharedState={yy:{}};for(var k in this.yy)Object.prototype.hasOwnProperty.call(this.yy,k)&&(sharedState.yy[k]=this.yy[k]);lexer.setInput(input,sharedState.yy),sharedState.yy.lexer=lexer,sharedState.yy.parser=this,void 0===lexer.yylloc&&(lexer.yylloc={});var yyloc=lexer.yylloc;lstack.push(yyloc);var ranges=lexer.options&&lexer.options.ranges;"function"==typeof sharedState.yy.parseError?this.parseError=sharedState.yy.parseError:this.parseError=Object.getPrototypeOf(this).parseError;for(var symbol,state,action,r,p,len,newState,expected,token,yyval={};;){if(state=stack[stack.length-1],this.defaultActions[state]?action=this.defaultActions[state]:(null==symbol&&(token=void 0,"number"!=typeof(token=lexer.lex()||1)&&(token=self.symbols_[token]||token),symbol=token),action=table[state]&&table[state][symbol]),void 0===action||!action.length||!action[0]){var errStr="";for(p in expected=[],table[state])this.terminals_[p]&&p>2&&expected.push("'"+this.terminals_[p]+"'");errStr=lexer.showPosition?"Parse error on line "+(yylineno+1)+":\n"+lexer.showPosition()+"\nExpecting "+expected.join(", ")+", got '"+(this.terminals_[symbol]||symbol)+"'":"Parse error on line "+(yylineno+1)+": Unexpected "+(1==symbol?"end of input":"'"+(this.terminals_[symbol]||symbol)+"'"),this.parseError(errStr,{text:lexer.match,token:this.terminals_[symbol]||symbol,line:lexer.yylineno,loc:lexer.yylloc,expected:expected})}if(action[0]instanceof Array&&action.length>1)throw new Error("Parse Error: multiple actions possible at state: "+state+", token: "+symbol);switch(action[0]){case 1:stack.push(symbol),vstack.push(lexer.yytext),lstack.push(lexer.yylloc),stack.push(action[1]),symbol=null,yyleng=lexer.yyleng,yytext=lexer.yytext,yylineno=lexer.yylineno,yyloc=lexer.yylloc;break;case 2:if(len=this.productions_[action[1]][1],yyval.$=vstack[vstack.length-len],yyval._$={first_line:lstack[lstack.length-(len||1)].first_line,last_line:lstack[lstack.length-1].last_line,first_column:lstack[lstack.length-(len||1)].first_column,last_column:lstack[lstack.length-1].last_column},ranges&&(yyval._$.range=[lstack[lstack.length-(len||1)].range[0],lstack[lstack.length-1].range[1]]),void 0!==(r=this.performAction.apply(yyval,[yytext,yyleng,yylineno,sharedState.yy,action[1],vstack,lstack].concat(args))))return r;len&&(stack=stack.slice(0,-1*len*2),vstack=vstack.slice(0,-1*len),lstack=lstack.slice(0,-1*len)),stack.push(this.productions_[action[1]][0]),vstack.push(yyval.$),lstack.push(yyval._$),newState=table[stack[stack.length-2]][stack[stack.length-1]],stack.push(newState);break;case 3:return!0}}return!0}};const COMPILER="RKP 1.0.0",LANG="ReKarel Pascal",VarsAsFuncs=!0,reqsPrototypes=!1;let tagCnt=1;function UniqueTag(tag){return`${tag}.${tagCnt++}`}function resetCompiler(tag){tagCnt=1}function locToIR(loc){return["LINE",loc.first_line-1,loc.first_column]}var lexer={EOF:1,parseError:function(str,hash){if(!this.yy.parser)throw new Error(str);this.yy.parser.parseError(str,hash)},setInput:function(input,yy){return this.yy=yy||this.yy||{},this._input=input,this._more=this._backtrack=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var ch=this._input[0];return this.yytext+=ch,this.yyleng++,this.offset++,this.match+=ch,this.matched+=ch,ch.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),ch},unput:function(ch){var len=ch.length,lines=ch.split(/(?:\r\n?|\n)/g);this._input=ch+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-len),this.offset-=len;var oldLines=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),lines.length-1&&(this.yylineno-=lines.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:lines?(lines.length===oldLines.length?this.yylloc.first_column:0)+oldLines[oldLines.length-lines.length].length-lines[0].length:this.yylloc.first_column-len},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-len]),this.yyleng=this.yytext.length,this},more:function(){return this._more=!0,this},reject:function(){return this.options.backtrack_lexer?(this._backtrack=!0,this):this.parseError("Lexical error on line "+(this.yylineno+1)+". You can only invoke reject() in the lexer when the lexer is of the backtracking persuasion (options.backtrack_lexer = true).\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},less:function(n){this.unput(this.match.slice(n))},pastInput:function(){var past=this.matched.substr(0,this.matched.length-this.match.length);return(past.length>20?"...":"")+past.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var next=this.match;return next.length<20&&(next+=this._input.substr(0,20-next.length)),(next.substr(0,20)+(next.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var pre=this.pastInput(),c=new Array(pre.length+1).join("-");return pre+this.upcomingInput()+"\n"+c+"^"},test_match:function(match,indexed_rule){var token,lines,backup;if(this.options.backtrack_lexer&&(backup={yylineno:this.yylineno,yylloc:{first_line:this.yylloc.first_line,last_line:this.last_line,first_column:this.yylloc.first_column,last_column:this.yylloc.last_column},yytext:this.yytext,match:this.match,matches:this.matches,matched:this.matched,yyleng:this.yyleng,offset:this.offset,_more:this._more,_input:this._input,yy:this.yy,conditionStack:this.conditionStack.slice(0),done:this.done},this.options.ranges&&(backup.yylloc.range=this.yylloc.range.slice(0))),(lines=match[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=lines.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:lines?lines[lines.length-1].length-lines[lines.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+match[0].length},this.yytext+=match[0],this.match+=match[0],this.matches=match,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._backtrack=!1,this._input=this._input.slice(match[0].length),this.matched+=match[0],token=this.performAction.call(this,this.yy,this,indexed_rule,this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),token)return token;if(this._backtrack){for(var k in backup)this[k]=backup[k];return!1}return!1},next:function(){if(this.done)return this.EOF;var token,match,tempMatch,index;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var rules=this._currentRules(),i=0;i<rules.length;i++)if((tempMatch=this._input.match(this.rules[rules[i]]))&&(!match||tempMatch[0].length>match[0].length)){if(match=tempMatch,index=i,this.options.backtrack_lexer){if(!1!==(token=this.test_match(tempMatch,rules[i])))return token;if(this._backtrack){match=!1;continue}return!1}if(!this.options.flex)break}return match?!1!==(token=this.test_match(match,rules[index]))&&token:""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var r=this.next();return r||this.lex()},begin:function(condition){this.conditionStack.push(condition)},popState:function(){return this.conditionStack.length-1>0?this.conditionStack.pop():this.conditionStack[0]},_currentRules:function(){return this.conditionStack.length&&this.conditionStack[this.conditionStack.length-1]?this.conditions[this.conditionStack[this.conditionStack.length-1]].rules:this.conditions.INITIAL.rules},topState:function(n){return(n=this.conditionStack.length-1-Math.abs(n||0))>=0?this.conditionStack[n]:"INITIAL"},pushState:function(condition){this.begin(condition)},stateStackSize:function(){return this.conditionStack.length},options:{flex:!0},performAction:function(yy,yy_,$avoiding_name_collisions,YY_START){switch($avoiding_name_collisions){case 0:case 1:case 2:break;case 3:return 5;case 4:case 5:return 7;case 6:case 7:return 9;case 8:return 10;case 9:case 10:case 11:return 32;case 12:return 13;case 13:case 14:return 35;case 15:case 16:return 33;case 17:case 18:return 30;case 19:case 20:return 34;case 21:case 22:return 31;case 23:case 24:case 25:return 51;case 26:return 26;case 27:case 28:return 41;case 29:return 38;case 30:return 37;case 31:return 39;case 32:return 40;case 33:case 34:return 42;case 35:return 43;case 36:return 49;case 37:return 50;case 38:return 57;case 39:return 59;case 40:return 60;case 41:return 61;case 42:return 63;case 43:return 94;case 44:return 93;case 45:case 46:return 71;case 47:return 74;case 48:return 75;case 49:return 76;case 50:return 77;case 51:return 78;case 52:return 79;case 53:return 80;case 54:return 81;case 55:case 56:return 82;case 57:case 58:return 83;case 59:return 85;case 60:return 87;case 61:return 86;case 62:return 84;case 63:return 89;case 64:return 91;case 65:return 90;case 66:return 88;case 67:case 68:return 58;case 69:return 55;case 70:return 69;case 71:case 72:return 64;case 73:case 74:return 65;case 75:return 22;case 76:return 24;case 77:return 15;case 78:return 17;case 79:return 29;case 80:return 18;case 81:return 66;case 82:return 68;case 83:return 67;case 84:return 95;case 85:return 16;case 86:return 11;case 87:console.log(yy_.yytext)}},rules:[/^(?:\s+)/,/^(?:\{[^}]*\})/,/^(?:\(\*(?:[^*]|\*(?!\)))*\*\))/,/^(?:iniciar-programa)/,/^(?:inicia-ejecucion)/,/^(?:inicia-ejecución)/,/^(?:termina-ejecucion)/,/^(?:termina-ejecución)/,/^(?:finalizar-programa)/,/^(?:define-nueva-instruccion)/,/^(?:define-nueva-instrucción)/,/^(?:define)/,/^(?:usa)/,/^(?:define-prototipo-instruccion)/,/^(?:define-prototipo-instrucción)/,/^(?:define-prototipo-calculo)/,/^(?:define-prototipo-cálculo)/,/^(?:define-calculo)/,/^(?:define-cálculo)/,/^(?:define-prototipo-condicion)/,/^(?:define-prototipo-condición)/,/^(?:define-condicion)/,/^(?:define-condición)/,/^(?:sal-de-instruccion)/,/^(?:sal-de-instrucción)/,/^(?:regresa)/,/^(?:como)/,/^(?:apagate)/,/^(?:apágate)/,/^(?:gira-izquierda)/,/^(?:avanza)/,/^(?:coge-zumbador)/,/^(?:deja-zumbador)/,/^(?:continua)/,/^(?:continúa)/,/^(?:rompe)/,/^(?:inicio)/,/^(?:fin)/,/^(?:entonces)/,/^(?:mientras)/,/^(?:hacer)/,/^(?:repetir)/,/^(?:veces)/,/^(?:precede)/,/^(?:sucede)/,/^(?:si-es-cero)/,/^(?:es-cero)/,/^(?:frente-libre)/,/^(?:frente-bloqueado)/,/^(?:izquierda-libre)/,/^(?:izquierda-bloqueada)/,/^(?:derecha-libre)/,/^(?:derecha-bloqueada)/,/^(?:junto-a-zumbador)/,/^(?:no-junto-a-zumbador)/,/^(?:algun-zumbador-en-la-mochila)/,/^(?:algún-zumbador-en-la-mochila)/,/^(?:ningun-zumbador-en-la-mochila)/,/^(?:ningún-zumbador-en-la-mochila)/,/^(?:orientado-al-norte)/,/^(?:orientado-al-sur)/,/^(?:orientado-al-este)/,/^(?:orientado-al-oeste)/,/^(?:no-orientado-al-norte)/,/^(?:no-orientado-al-sur)/,/^(?:no-orientado-al-este)/,/^(?:no-orientado-al-oeste)/,/^(?:sino)/,/^(?:si-no)/,/^(?:si)/,/^(?:no)/,/^(?:o)/,/^(?:u)/,/^(?:y)/,/^(?:e)/,/^(?:\()/,/^(?:\))/,/^(?:;)/,/^(?:\.)/,/^(?:,)/,/^(?:\*)/,/^(?:==)/,/^(?:<=)/,/^(?:<)/,/^(?:[0-9]+)/,/^(?:[A-Za-zÀ-ÖØ-öø-ÿ_][A-Za-zÀ-ÖØ-öø-ÿ0-9_-]*)/,/^(?:$)/,/^(?:.)/],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87],inclusive:!0}}};function Parser(){this.yy={}}return parser.lexer=lexer,Parser.prototype=parser,parser.Parser=Parser,new Parser}();function UnitePackages(packages){const booleans=new Map,numbers=new Map;for(const pack of packages)pack.numberVariables.forEach(((value,key,_)=>{numbers.set(key,value)})),pack.booleanVariables.forEach(((value,key,_)=>{booleans.set(key,value)}));return{booleanVariables:booleans,numberVariables:numbers}}const javaNumbers=new Map,javaBooleans=new Map;javaNumbers.set("beepersInBeeperBag",[["BAGBUZZERS"]]),javaNumbers.set("beepersOnFloor",[["WORLDBUZZERS"]]),javaNumbers.set("currentRow",[["ROW"]]),javaNumbers.set("currentColumn",[["COLUMN"]]),javaBooleans.set("true",[["LOAD",1]]),javaBooleans.set("false",[["LOAD",0]]);const rekarelGlobalsJava={booleanVariables:javaBooleans,numberVariables:javaNumbers},pascalNumbers=new Map,pascalBooleans=new Map;pascalNumbers.set("zumbadores-en-la-mochila",[["BAGBUZZERS"]]),pascalNumbers.set("zumbadores-del-piso",[["WORLDBUZZERS"]]),pascalNumbers.set("columna-actual",[["COLUMN"]]),pascalNumbers.set("fila-actual",[["ROW"]]),pascalBooleans.set("verdadero",[["LOAD",1]]),pascalBooleans.set("falso",[["LOAD",0]]);const rekarelGlobalsPascal={booleanVariables:pascalBooleans,numberVariables:pascalNumbers},JavaPackages={"rekarel.globals":rekarelGlobalsJava,"rekarel.*":UnitePackages([rekarelGlobalsJava])},PascalPackages={"rekarel.globales":rekarelGlobalsPascal,"rekarel.*":UnitePackages([rekarelGlobalsPascal])};class DefinitionTable{constructor(variablesCanBeFunctions){this.functions=new Map,this.variables=new Map,this.variablesCanBeFunctions=variablesCanBeFunctions,this.tagCounter=0}getType(identifier){return this.variables.has(identifier)?this.variables.get(identifier).dataType:this.functions.has(identifier)?this.functions.get(identifier).returnType:"undefined"}registerFunction(func){this.functions.set(func.name,{arguments:func.params,location:0,returnType:func.returnType})}hasFunction(name){return this.functions.has(name)}getFunction(name){return this.functions.get(name)}setFunctionLoc(target,location){this.functions.get(target).location=location}registerVar(name,val){this.variables.set(name,val)}hasVar(name){return this.variables.has(name)}getVar(name){return this.variables.get(name)}getUniqueTag(name){return`${name}.${this.tagCounter++}`}}var CompilationError;function resolveTerm(tree,definitions,scope,target,tags,yy){if("ATOM"===tree.operation){if(resolveListWithASTs(tree.instructions,definitions,scope,target,tags,yy),tree.dataType.startsWith("$")){const termType=tree.dataType.substring(1);return scope.parameters.some((e=>e.name===termType))?"INT":definitions.getType(tree.dataType.substring(1))}return tree.dataType}if("AND"===tree.operation||"OR"===tree.operation){const leftType=resolveTerm(tree.left,definitions,scope,target,tags,yy);target.push(["DUP"]),"OR"===tree.operation&&target.push(["NOT"]);const shortCircuit=definitions.getUniqueTag("shortCircuit");target.push(["TJZ",shortCircuit]);const rightType=resolveTerm(tree.right,definitions,scope,target,tags,yy);return"BOOL"!==leftType&&yy.parser.parseError(`${tree.operation} operator uses booleans terms only, left is of type: ${leftType}`,{error:CompilationError.Errors.BINARY_OPERATOR_TYPE_ERROR,operator:tree.operation,loc:tree.loc,line:tree.loc.first_line-1,expectedType:"BOOL",actualType:leftType,direction:"LEFT"}),"BOOL"!==rightType&&yy.parser.parseError(`${tree.operation} operator uses booleans terms only, right is of type: ${rightType}`,{error:CompilationError.Errors.BINARY_OPERATOR_TYPE_ERROR,operator:tree.operation,loc:tree.loc,line:tree.loc.first_line-1,expectedType:"BOOL",actualType:rightType,direction:"RIGHT"}),target.push([tree.operation]),resolveListWithASTs([["TAG",shortCircuit]],definitions,scope,target,tags,yy),tree.dataType}if("EQ"===tree.operation){const leftType=resolveTerm(tree.left,definitions,scope,target,tags,yy),rightType=resolveTerm(tree.right,definitions,scope,target,tags,yy);return leftType!==rightType&&yy.parser.parseError(`An equality comparison cannot be performed between type ${leftType} and ${rightType}`,{error:CompilationError.Errors.COMPARISON_TYPE,loc:tree.loc,line:tree.loc.first_line-1,leftType:leftType,rightType:rightType}),"VOID"===leftType&&yy.parser.parseError("An equality comparison cannot be performed on VOID",{error:CompilationError.Errors.VOID_COMPARISON,loc:tree.loc,line:tree.loc.first_line-1,leftType:leftType,rightType:rightType}),target.push([tree.operation]),tree.dataType}if("LT"===tree.operation||"LTE"===tree.operation){const leftType=resolveTerm(tree.left,definitions,scope,target,tags,yy),rightType=resolveTerm(tree.right,definitions,scope,target,tags,yy);return"INT"!==leftType&&yy.parser.parseError(`${tree.operation} operator uses integer terms only, left is of type: ${leftType}`,{error:CompilationError.Errors.BINARY_OPERATOR_TYPE_ERROR,loc:tree.loc,operator:tree.operation,line:tree.loc.first_line-1,direction:"LEFT",expectedType:"INT",actualType:leftType}),"INT"!==rightType&&yy.parser.parseError(`${tree.operation} operator uses integer terms only, right is of type: ${rightType}`,{error:CompilationError.Errors.BINARY_OPERATOR_TYPE_ERROR,loc:tree.loc,operator:tree.operation,direction:"RIGHT",line:tree.loc.first_line-1,expectedType:"INT",actualType:rightType}),target.push([tree.operation]),tree.dataType}if("NOT"===tree.operation){const termType=resolveTerm(tree.term,definitions,scope,target,tags,yy);return"BOOL"!==termType&&yy.parser.parseError(`${tree.operation} operator uses a boolean terms only, but tried to negate a term of type: ${termType}`,{error:CompilationError.Errors.UNARY_OPERATOR_TYPE_ERROR,loc:tree.loc,operator:tree.operation,line:tree.loc.first_line-1,expectedType:"BOOL",actualType:termType}),target.push([tree.operation]),tree.dataType}if("PASS"===tree.operation){const termType=resolveTerm(tree.term,definitions,scope,target,tags,yy);return termType!==tree.dataType&&yy.parser.parseError(`Expected a term of type ${tree.dataType}, but got ${termType}`,{error:CompilationError.Errors.TYPE_ERROR,loc:tree.totalLoc,line:tree.totalLoc.first_line-1,expectedType:tree.dataType,actualType:termType}),tree.dataType}if("PARENTHESIS"===tree.operation){return resolveTerm(tree.term,definitions,scope,target,tags,yy)}}function resolveVar(data,definitions,scope,target,yy){const parameterIdx=scope.parameters.findIndex((e=>data.target===e.name));if(-1===parameterIdx)if(definitions.hasVar(data.target)){const IRs=definitions.getVar(data.target).instructions;for(const instruction of IRs)target.push(instruction)}else{if(data.couldBeFunction)return resolveCall$2({nameLoc:data.loc,params:[],target:data.target,expectedType:data.expectedType},definitions,scope,target,{},yy),void target.push(["LRET"]);yy.parser.parseError("Unknown variable or parameter: "+data.target,{error:CompilationError.Errors.UNKNOWN_VARIABLE,variable:data.target,line:data.loc.first_line-1,loc:data.loc})}else target.push(["PARAM",scope.parameters.length-parameterIdx-1])}function resolveCall$2(data,definitions,scope,target,tags,yy){for(const parameter of data.params)resolveTerm(parameter,definitions,scope,target,tags,yy);if(target.push(["LOAD",data.params.length]),target.push(["LINE",data.nameLoc.first_line-1,data.nameLoc.first_column]),!definitions.hasFunction(data.target))return yy.parser.parseError("Undefined function: "+data.target,{error:CompilationError.Errors.UNDEFINED_FUNCTION,functionName:data.target,line:data.nameLoc.first_line-1,loc:data.nameLoc}),null;target.push(["CALL",data]),target.push(["LINE",data.nameLoc.first_line-1,data.nameLoc.first_column+data.target.length])}function resolveReturn(data,definitions,scope,target,tags,yy){const retType=resolveTerm(data.term,definitions,scope,target,tags,yy);scope.expectedReturn!==retType&&yy.parser.parseError(`Cannot return a type: ${retType}, in a function of type: ${scope.expectedReturn}`,{error:CompilationError.Errors.RETURN_TYPE,line:data.loc.first_line-1,loc:data.loc,expectedType:scope.expectedReturn,actualType:retType}),target.push(["SRET"]),target.push(["LINE",data.loc.first_line-1,data.loc.first_column]),target.push(["RET",data])}function resolveRepeat(data,definitions,scope,target,tags,yy){target.push(data.line),resolveTerm(data.loopCount[1],definitions,scope,target,tags,yy),resolveListWithASTs([["TAG",data.repeatTag],["DUP"],["LOAD",0],["EQ"],["NOT"],["TJZ",data.endTag]],definitions,scope,target,tags,yy);const loopScope=scope.withContinueBreakTarget(data.continueTag,data.endTag);resolveListWithASTs(data.instructions,definitions,loopScope,target,tags,yy),resolveListWithASTs([["TAG",data.continueTag],["DEC",1],["TJMP",data.repeatTag],["TAG",data.endTag],["POP"]],definitions,scope,target,tags,yy)}function resolveWhile(data,definitions,scope,target,tags,yy){resolveListWithASTs([["TAG",data.repeatTag]],definitions,scope,target,tags,yy),target.push(data.line),resolveTerm(data.condition[1],definitions,scope,target,tags,yy),resolveListWithASTs([["TJZ",data.endTag]],definitions,scope,target,tags,yy);const whileScope=scope.withContinueBreakTarget(data.repeatTag,data.endTag);resolveListWithASTs(data.instructions,definitions,whileScope,target,tags,yy),resolveListWithASTs([["TJMP",data.repeatTag],["TAG",data.endTag]],definitions,scope,target,tags,yy)}function resolveConditional(data,definitions,scope,target,tags,yy){let trueReturns=!1,falseReturns=!1;return target.push(data.line),resolveTerm(data.condition[1],definitions,scope,target,tags,yy),resolveListWithASTs([["TJZ",data.skipTrueTag]],definitions,scope,target,tags,yy),trueReturns=resolveListWithASTs(data.trueCase,definitions,scope,target,tags,yy).explicitReturn,data.skipFalseTag&&resolveListWithASTs([["TJMP",data.skipFalseTag]],definitions,scope,target,tags,yy),resolveListWithASTs([["TAG",data.skipTrueTag]],definitions,scope,target,tags,yy),data.skipFalseTag&&data.falseCase&&(falseReturns=resolveListWithASTs(data.falseCase,definitions,scope,target,tags,yy).explicitReturn,resolveListWithASTs([["TAG",data.skipFalseTag]],definitions,scope,target,tags,yy)),{explicitReturn:trueReturns&&falseReturns}}function resolveListWithASTs(IRInstructions,definitions,scope,target,tags,yy){const info={explicitReturn:!1};for(const instruction of IRInstructions)if("VAR"!==instruction[0])if("FORWARD"!==instruction[0])if("PICKBUZZER"!==instruction[0])if("LEAVEBUZZER"!==instruction[0])if("TERM"!==instruction[0])if("TAG"!==instruction[0])if("CALL"!==instruction[0])if("RET"!==instruction[0])if("REPEAT"!==instruction[0])if("WHILE"!==instruction[0])if("IF"!==instruction[0])"CONTINUE"!==instruction[0]?"BREAK"!==instruction[0]?target.push(instruction):(null==scope.breakTarget&&yy.parser.parseError("Cannot use break in this scope",{error:CompilationError.Errors.ILLEGAL_BREAK,loc:instruction[1],line:instruction[1].first_line-1}),target.push(["TJMP",scope.breakTarget])):(null==scope.continueTarget&&yy.parser.parseError("Cannot use continue in this scope",{error:CompilationError.Errors.ILLEGAL_CONTINUE,loc:instruction[1],line:instruction[1].first_line-1}),target.push(["TJMP",scope.continueTarget]));else{resolveConditional(instruction[1],definitions,scope,target,tags,yy).explicitReturn&&(info.explicitReturn=!0)}else resolveWhile(instruction[1],definitions,scope,target,tags,yy);else resolveRepeat(instruction[1],definitions,scope,target,tags,yy);else{if("__DEFAULT"===instruction[1]){target.push(["LOAD",0]),target.push(["SRET"]),target.push(["LINE",instruction[2].first_line-1,instruction[2].first_column]),target.push(instruction);continue}resolveReturn(instruction[1],definitions,scope,target,tags,yy),info.explicitReturn=!0}else resolveCall$2(instruction[1],definitions,scope,target,tags,yy);else tags[instruction[1]]=target.length;else resolveTerm(instruction[1],definitions,scope,target,tags,yy);else target.push(["BAGBUZZERS"]),target.push(["EZ","BAGUNDERFLOW"]),target.push(instruction);else target.push(["WORLDBUZZERS"]),target.push(["EZ","WORLDUNDERFLOW"]),target.push(instruction);else target.push(["WORLDWALLS"]),target.push(["ORIENTATION"]),target.push(["MASK"]),target.push(["AND"]),target.push(["NOT"]),target.push(["EZ","WALL"]),target.push(instruction);else resolveVar(instruction[1],definitions,scope,target,yy);return info}!function(CompilationError){var Errors;(Errors=CompilationError.Errors||(CompilationError.Errors={}))[Errors.BINARY_OPERATOR_TYPE_ERROR=0]="BINARY_OPERATOR_TYPE_ERROR",Errors[Errors.CALL_TYPE=1]="CALL_TYPE",Errors[Errors.COMPARISON_TYPE=2]="COMPARISON_TYPE",Errors[Errors.FUNCTION_ILLEGAL_NAME=3]="FUNCTION_ILLEGAL_NAME",Errors[Errors.FUNCTION_REDEFINITION=4]="FUNCTION_REDEFINITION",Errors[Errors.ILLEGAL_BREAK=5]="ILLEGAL_BREAK",Errors[Errors.ILLEGAL_CONTINUE=6]="ILLEGAL_CONTINUE",Errors[Errors.NO_EXPLICIT_RETURN=7]="NO_EXPLICIT_RETURN",Errors[Errors.PARAMETER_ILLEGAL_NAME=8]="PARAMETER_ILLEGAL_NAME",Errors[Errors.PARAMETER_REDEFINITION=9]="PARAMETER_REDEFINITION",Errors[Errors.PROTOTYPE_PARAMETERS_MISS_MATCH=10]="PROTOTYPE_PARAMETERS_MISS_MATCH",Errors[Errors.PROTOTYPE_TYPE_MISS_MATCH=11]="PROTOTYPE_TYPE_MISS_MATCH",Errors[Errors.PROTOTYPE_REDEFINITION=12]="PROTOTYPE_REDEFINITION",Errors[Errors.RETURN_TYPE=13]="RETURN_TYPE",Errors[Errors.TOO_FEW_PARAMS_IN_CALL=14]="TOO_FEW_PARAMS_IN_CALL",Errors[Errors.TOO_MANY_PARAMS_IN_CALL=15]="TOO_MANY_PARAMS_IN_CALL",Errors[Errors.TYPE_ERROR=16]="TYPE_ERROR",Errors[Errors.UNDEFINED_FUNCTION=17]="UNDEFINED_FUNCTION",Errors[Errors.UNDEFINED_FUNCTION_OR_VARIABLE=18]="UNDEFINED_FUNCTION_OR_VARIABLE",Errors[Errors.UNARY_OPERATOR_TYPE_ERROR=19]="UNARY_OPERATOR_TYPE_ERROR",Errors[Errors.UNKNOWN_MODULE=20]="UNKNOWN_MODULE",Errors[Errors.UNKNOWN_PACKAGE=21]="UNKNOWN_PACKAGE",Errors[Errors.UNKNOWN_SYNTAX=22]="UNKNOWN_SYNTAX",Errors[Errors.UNKNOWN_VARIABLE=23]="UNKNOWN_VARIABLE",Errors[Errors.VOID_COMPARISON=24]="VOID_COMPARISON"}(CompilationError||(CompilationError={}));class Scope{constructor(data){this.parameters=data.parameters,this.expectedReturn=data.expectedReturn,this.continueTarget=data.continueTarget,this.breakTarget=data.breakTarget}withContinueTarget(continueTarget){return new Scope({parameters:this.parameters,expectedReturn:this.expectedReturn,continueTarget:continueTarget,breakTarget:this.breakTarget})}withBreakTarget(breakTarget){return new Scope({parameters:this.parameters,expectedReturn:this.expectedReturn,continueTarget:this.continueTarget,breakTarget:breakTarget})}withContinueBreakTarget(continueTarget,breakTarget){return new Scope({parameters:this.parameters,expectedReturn:this.expectedReturn,continueTarget:continueTarget,breakTarget:breakTarget})}}const MAIN_SCOPE=new Scope({expectedReturn:"VOID",parameters:[]});class DebugData{}function resolveComplexIR(IRInstructions,yy,definitions,scope,func){let result=[];const tags={};let info=resolveListWithASTs(IRInstructions,definitions,scope,result,tags,yy);return"VOID"===scope.expectedReturn||info.explicitReturn||yy.parser.parseError(`Explicit return is required in function ${func.name}`,{error:CompilationError.Errors.NO_EXPLICIT_RETURN,loc:func.loc,line:func.loc.first_line-1,functionName:func.name,returnType:scope.expectedReturn}),result.map(((instruction,idx)=>{if("TJMP"===instruction[0]){return["JMP",tags[instruction[1]]-idx-1]}if("TJZ"===instruction[0]){return["JZ",tags[instruction[1]]-idx-1]}return instruction}))}function generateOpcodesFromIR(data,exportDebug){const definitions=new DefinitionTable(data.variablesCanBeFunctions),debugData=new DebugData;if(function(data,definitions){const compPackages="ReKarel Java"===data.language?JavaPackages:PascalPackages,yy=data.yy;for(const pack of data.packages){const packageName=pack[0].split(".")[0],moduleName=pack[0].split(".")[1];"rekarel"!==packageName&&yy.parser.parseError("Package not recognized: "+pack[0],{error:CompilationError.Errors.UNKNOWN_PACKAGE,package:packageName,module:moduleName,full:pack[0],loc:pack[1],line:pack[1].first_line-1}),compPackages[pack[0]]||yy.parser.parseError("Module not found: "+pack[0],{error:CompilationError.Errors.UNKNOWN_MODULE,package:packageName,module:moduleName,full:pack[0],loc:pack[1],line:pack[1].first_line-1});const packObject=compPackages[pack[0]];for(let[varName,varVal]of packObject.numberVariables)definitions.registerVar(varName,{instructions:varVal,dataType:"INT"});for(let[varName,varVal]of packObject.booleanVariables)definitions.registerVar(varName,{instructions:varVal,dataType:"BOOL"})}}(data,definitions),!function(data,definitionTable){const yy=data.yy,prototypes=new Map;for(const func of data.functions){for(const parameter of func.params)if(definitionTable.hasVar(parameter.name))return yy.parser.parseError("Cannot name a parameter as a global variable",{error:CompilationError.Errors.PARAMETER_ILLEGAL_NAME,parameterName:parameter.name,line:parameter.loc.first_line-1,loc:parameter.loc}),!1;if(definitionTable.hasVar(func.name))return yy.parser.parseError("Cannot name a function as a global variable",{error:CompilationError.Errors.FUNCTION_ILLEGAL_NAME,functionName:func.name,line:func.loc.first_line-1,loc:func.loc}),!1;if(null==func.code){if(prototypes.has(func.name))return yy.parser.parseError("Prototype redefinition: "+func.name,{error:CompilationError.Errors.PROTOTYPE_REDEFINITION,prototypeName:func.name,line:func.loc.first_line-1,loc:func.loc}),!1;prototypes.set(func.name,{argCount:func.params.length,defined:!1,returnType:func.returnType});continue}prototypes.has(func.name)||prototypes.set(func.name,{argCount:func.params.length,defined:!1,returnType:func.returnType});const proto=prototypes.get(func.name);if(proto.defined)return yy.parser.parseError("Function redefinition: "+func.name,{error:CompilationError.Errors.FUNCTION_REDEFINITION,functionName:func.name,line:func.loc.first_line-1,loc:func.loc}),!1;if(proto.argCount!==func.params.length)return yy.parser.parseError("Prototype parameter mismatch: "+func.name,{error:CompilationError.Errors.PROTOTYPE_PARAMETERS_MISS_MATCH,line:func.loc.first_line-1,loc:func.loc,functionName:func.name,functionParamCount:func.params.length,prototypeParamCount:proto.argCount}),!1;if(proto.returnType!==func.returnType)return yy.parser.parseError("Prototype type mismatch: "+func.name,{error:CompilationError.Errors.PROTOTYPE_TYPE_MISS_MATCH,line:func.loc.first_line-1,loc:func.loc,functionName:func.name,functionType:func.returnType,prototypeType:proto.returnType}),!1;prototypes.set(func.name,{argCount:func.params.length,defined:!0,returnType:func.returnType}),definitionTable.registerFunction(func);for(const instruction of func.code)if(data.requieresFunctionPrototypes&&"CALL"===instruction[0]){const data=instruction[1];if(!prototypes.has(data.target))return yy.parser.parseError("Undefined function: "+data.target,{error:CompilationError.Errors.UNDEFINED_FUNCTION,functionName:data.target,line:data.nameLoc.first_line-1,loc:data.nameLoc}),!1}}for(const func of data.functions)func.params.forEach(((param,idx)=>{(definitionTable.hasVar(param.name)||definitionTable.hasFunction(param.name))&&yy.parser.parseError(`Cannot name parameter ${param.name} as it is already used by a variable or function`,{error:CompilationError.Errors.PARAMETER_ILLEGAL_NAME,line:param.loc.first_line-1,loc:param.loc,parameterName:param.name}),func.params.findIndex((p=>p.name===param.name))!==idx&&yy.parser.parseError(`Parameter ${param.name} was already declared in the function`,{error:CompilationError.Errors.PARAMETER_REDEFINITION,line:param.loc.first_line-1,loc:param.loc,parameterName:param.name})}));return!0}(data,definitions))throw new Error("This should not be reachable, it should have thrown before");let IRProgram=resolveComplexIR(data.program,data.yy,definitions,MAIN_SCOPE);for(const func of data.functions){if(null==func.code)continue;definitions.setFunctionLoc(func.name,IRProgram.length);const functionScope=new Scope({parameters:func.params,expectedReturn:func.returnType}),code=resolveComplexIR(func.code,data.yy,definitions,functionScope,func);IRProgram=IRProgram.concat(code)}const program=[];for(const instruction of IRProgram)if("CALL"!==instruction[0])"RET"!==instruction[0]?program.push(instruction):program.push(["RET"]);else{const iData=instruction[1];if(!definitions.hasFunction(iData.target))return data.yy.parser.parseError("Undefined function: "+iData.target,{error:CompilationError.Errors.UNDEFINED_FUNCTION,functionName:iData.target,line:iData.nameLoc.first_line-1,loc:iData.nameLoc}),null;const targetFunc=definitions.getFunction(iData.target);if(targetFunc.arguments.length<iData.params.length){const extraParam=iData.params[iData.params.length-targetFunc.arguments.length-1];data.yy.parser.parseError(`Too many parameters in call to function ${iData.target}, expected ${targetFunc.arguments.length}, got ${iData.params.length}`,{error:CompilationError.Errors.TOO_MANY_PARAMS_IN_CALL,line:extraParam.totalLoc.first_line-1,loc:extraParam.totalLoc,functionName:iData.target,expectedParams:iData.params.length,actualParams:targetFunc.arguments.length})}targetFunc.arguments.length>iData.params.length&&data.yy.parser.parseError(`Too few parameters in call to function ${iData.target}, expected ${targetFunc.arguments.length}, got ${iData.params.length}`,{error:CompilationError.Errors.TOO_FEW_PARAMS_IN_CALL,line:iData.nameLoc.first_line-1,loc:iData.nameLoc,funcName:iData.target,expectedParams:iData.params.length,actualParams:targetFunc.arguments.length}),null!=iData.expectedType&&iData.expectedType!==targetFunc.returnType&&data.yy.parser.parseError(`Expected a function of type ${iData.expectedType}, but ${iData.target} is ${targetFunc.returnType}`,{error:CompilationError.Errors.CALL_TYPE,line:iData.nameLoc.first_line-1,loc:iData.nameLoc,funcName:iData.target,expectedCallType:iData.expectedType,functionType:targetFunc.returnType}),program.push(["CALL",targetFunc.location,iData.target])}return exportDebug?(debugData.definitions=definitions,[program,debugData]):[program,null]}const javaParser=function(){return kareljava.parse.apply(kareljava,arguments)},pascalParser=function(){return karelpascal.parse.apply(karelpascal,arguments)};function javaCompiler(code,exportDebug=!1){return generateOpcodesFromIR(javaParser(code),exportDebug)}function pascalCompiler(code,exportDebug=!1){return generateOpcodesFromIR(pascalParser(code),exportDebug)}class KarelRuntimeEvent extends Event{constructor(type,runtime,details){super(type),this.details=details,this.runtime=runtime}}class KarelRuntimeEventTarget{constructor(){this.listeners={}}addEventListener(type,callback){this.listeners.hasOwnProperty(type)||(this.listeners[type]=[]),this.listeners[type].push(callback)}dispatchEvent(event){if(!this.listeners.hasOwnProperty(event.type))return!1;for(const listener of this.listeners[event.type])listener(event);return!0}removeEventListener(type,callback){if(!this.listeners.hasOwnProperty(type))return;const index=this.listeners[type].indexOf(callback);-1!==index&&(this.listeners[type]=this.listeners[type].splice(index,1))}fireEvent(type,runtime,data){const evt=new KarelRuntimeEvent(type,runtime,data);this.dispatchEvent(evt)}}var OpCodeID,ErrorType,DumpTypes,ERROR_MAPPING;!function(OpCodeID){OpCodeID[OpCodeID.HALT=0]="HALT",OpCodeID[OpCodeID.LINE=1]="LINE",OpCodeID[OpCodeID.LEFT=2]="LEFT",OpCodeID[OpCodeID.WORLDWALLS=3]="WORLDWALLS",OpCodeID[OpCodeID.ORIENTATION=4]="ORIENTATION",OpCodeID[OpCodeID.ROTL=5]="ROTL",OpCodeID[OpCodeID.ROTR=6]="ROTR",OpCodeID[OpCodeID.MASK=7]="MASK",OpCodeID[OpCodeID.NOT=8]="NOT",OpCodeID[OpCodeID.AND=9]="AND",OpCodeID[OpCodeID.OR=10]="OR",OpCodeID[OpCodeID.EQ=11]="EQ",OpCodeID[OpCodeID.EZ=12]="EZ",OpCodeID[OpCodeID.JZ=13]="JZ",OpCodeID[OpCodeID.JMP=14]="JMP",OpCodeID[OpCodeID.FORWARD=15]="FORWARD",OpCodeID[OpCodeID.WORLDBUZZERS=16]="WORLDBUZZERS",OpCodeID[OpCodeID.BAGBUZZERS=17]="BAGBUZZERS",OpCodeID[OpCodeID.PICKBUZZER=18]="PICKBUZZER",OpCodeID[OpCodeID.LEAVEBUZZER=19]="LEAVEBUZZER",OpCodeID[OpCodeID.LOAD=20]="LOAD",OpCodeID[OpCodeID.POP=21]="POP",OpCodeID[OpCodeID.DUP=22]="DUP",OpCodeID[OpCodeID.DEC=23]="DEC",OpCodeID[OpCodeID.INC=24]="INC",OpCodeID[OpCodeID.CALL=25]="CALL",OpCodeID[OpCodeID.RET=26]="RET",OpCodeID[OpCodeID.PARAM=27]="PARAM",OpCodeID[OpCodeID.SRET=28]="SRET",OpCodeID[OpCodeID.LRET=29]="LRET",OpCodeID[OpCodeID.LT=30]="LT",OpCodeID[OpCodeID.LTE=31]="LTE",OpCodeID[OpCodeID.COLUMN=32]="COLUMN",OpCodeID[OpCodeID.ROW=33]="ROW"}(OpCodeID||(OpCodeID={})),function(ErrorType){ErrorType.INSTRUCTION="INSTRUCTION",ErrorType.STACK="STACK",ErrorType.WALL="WALL",ErrorType.WORLDUNDERFLOW="WORLDUNDERFLOW",ErrorType.BAGUNDERFLOW="BAGUNDERFLOW",ErrorType.INVALIDOPCODE="INVALIDOPCODE",ErrorType.STACKMEMORY="STACKMEMORY",ErrorType.CALLSIZE="CALLMEMORY"}(ErrorType||(ErrorType={}));class Runtime{constructor(world){this.world=world,this.debug=!1,this.disableStackEvents=!1,this.eventController=new KarelRuntimeEventTarget,this.load([["HALT"]])}load(opcodes){let error_mapping=["WALL","WORLDUNDERFLOW","BAGUNDERFLOW","INSTRUCTION"];this.rawOpcodes=opcodes;let function_map={};this.functionNames=[];let function_idx=0;this.program=new Int32Array(new ArrayBuffer(3*opcodes.length*4));for(let i=0;i<opcodes.length;i++){const currentOpcode=opcodes[i];if(this.program[3*i]=(literal=currentOpcode[0])in OpCodeID?OpCodeID[literal]:-1,currentOpcode.length>1&&(this.program[3*i+1]=currentOpcode[1]),"LINE"==currentOpcode[0]&&(this.program[3*i+2]=currentOpcode[2]),"CALL"==currentOpcode[0])function_map.hasOwnProperty(currentOpcode[2])||(function_map[currentOpcode[2]]=function_idx,this.functionNames[function_idx++]=currentOpcode[2]),this.program[3*i+2]=function_map[currentOpcode[2]];else if("EZ"==currentOpcode[0]&&(this.program[3*i+1]=error_mapping.indexOf(currentOpcode[1]),-1==this.program[3*i+1]))throw new Error("Invalid error: "+currentOpcode[1])}var literal;this.reset()}start(){this.eventController.fireEvent("start",this,{type:"start",target:this,world:this.world})}reset(){this.state={pc:0,sp:-1,fp:-1,line:-1,column:-1,ic:0,ret:0,stack:new Int32Array(new ArrayBuffer(4194400)),stackSize:0,stackMemory:0,moveCount:0,turnLeftCount:0,pickBuzzerCount:0,leaveBuzzerCount:0,jumped:!1,running:!0},this.debug&&this.eventController.fireEvent("debug",this,{type:"debug",target:this,message:JSON.stringify(this.rawOpcodes),debugType:"program"})}step(){for(;this.state.running;)try{if(this.program[3*this.state.pc]==OpCodeID.LINE){this.next();break}this.next()}finally{this.state.running||this.eventController.fireEvent("stop",this,{type:"stop",target:this,world:this.world})}return this.state.running}next(){if(!this.state.running)return;let rot,world=this.world;if(this.state.ic>=world.maxInstructions)return this.state.running=!1,this.state.error=ErrorType.INSTRUCTION,!1;if(this.state.stackSize>=this.world.maxStackSize)return this.state.running=!1,this.state.error=ErrorType.STACK,!1;let paramCount,newSP,op1,op2,fname,params,line,fromFName,npc,di=[0,1,0,-1],dj=[-1,0,1,0];try{switch(this.debug&&this.eventController.fireEvent("debug",this,{type:"debug",target:this,message:JSON.stringify(this.program[3*this.state.pc]+" "+this.rawOpcodes[this.state.pc]),debugType:"opcode"}),this.program[3*this.state.pc]){case OpCodeID.HALT:this.state.running=!1;break;case OpCodeID.LINE:this.state.line=this.program[3*this.state.pc+1],this.state.column=this.program[3*this.state.pc+2];break;case OpCodeID.LEFT:this.state.ic++,this.world.orientation--,this.world.orientation<0&&(this.world.orientation=3),this.world.dirty=!0,this.state.turnLeftCount++,this.world.maxTurnLeft>=0&&this.state.turnLeftCount>this.world.maxTurnLeft&&(this.state.running=!1,this.state.error=ErrorType.INSTRUCTION,this.state.errorData={type:ErrorType.INSTRUCTION,instruction:"LEFT"});break;case OpCodeID.WORLDWALLS:this.state.stack[++this.state.sp]=world.walls(world.i,world.j);break;case OpCodeID.ORIENTATION:this.state.stack[++this.state.sp]=world.orientation;break;case OpCodeID.ROTL:rot=this.state.stack[this.state.sp]-1,rot<0&&(rot=3),this.state.stack[this.state.sp]=rot;break;case OpCodeID.ROTR:rot=this.state.stack[this.state.sp]+1,rot>3&&(rot=0),this.state.stack[this.state.sp]=rot;break;case OpCodeID.MASK:this.state.stack[this.state.sp]=1<<this.state.stack[this.state.sp];break;case OpCodeID.NOT:this.state.stack[this.state.sp]=0===this.state.stack[this.state.sp]?1:0;break;case OpCodeID.AND:op2=this.state.stack[this.state.sp--],op1=this.state.stack[this.state.sp--],this.state.stack[++this.state.sp]=op1&op2?1:0;break;case OpCodeID.OR:op2=this.state.stack[this.state.sp--],op1=this.state.stack[this.state.sp--],this.state.stack[++this.state.sp]=op1|op2?1:0;break;case OpCodeID.EQ:op2=this.state.stack[this.state.sp--],op1=this.state.stack[this.state.sp--],this.state.stack[++this.state.sp]=op1==op2?1:0;break;case OpCodeID.EZ:0===this.state.stack[this.state.sp--]&&(this.state.error=[ErrorType.WALL,ErrorType.WORLDUNDERFLOW,ErrorType.BAGUNDERFLOW][this.program[3*this.state.pc+1]],this.state.running=!1);break;case OpCodeID.JZ:this.state.ic++,0===this.state.stack[this.state.sp--]&&(this.state.pc+=this.program[3*this.state.pc+1]);break;case OpCodeID.JMP:this.state.ic++,this.state.pc+=this.program[3*this.state.pc+1];break;case OpCodeID.FORWARD:this.state.ic++,this.world.i+=di[this.world.orientation],this.world.j+=dj[this.world.orientation],this.world.dirty=!0,this.state.moveCount++,this.world.maxMove>=0&&this.state.moveCount>this.world.maxMove&&(this.state.running=!1,this.state.error=ErrorType.INSTRUCTION,this.state.errorData={type:ErrorType.INSTRUCTION,instruction:"FORWARD"});break;case OpCodeID.WORLDBUZZERS:this.state.stack[++this.state.sp]=this.world.buzzers(world.i,world.j);break;case OpCodeID.BAGBUZZERS:this.state.stack[++this.state.sp]=this.world.bagBuzzers;break;case OpCodeID.PICKBUZZER:this.state.ic++,this.world.pickBuzzer(this.world.i,this.world.j),this.state.pickBuzzerCount++,this.world.maxPickBuzzer>=0&&this.state.pickBuzzerCount>this.world.maxPickBuzzer&&(this.state.running=!1,this.state.error=ErrorType.INSTRUCTION,this.state.errorData={type:ErrorType.INSTRUCTION,instruction:"PICKBUZZER"});break;case OpCodeID.LEAVEBUZZER:this.state.ic++,this.world.leaveBuzzer(this.world.i,this.world.j),this.state.leaveBuzzerCount++,this.world.maxLeaveBuzzer>=0&&this.state.leaveBuzzerCount>this.world.maxLeaveBuzzer&&(this.state.running=!1,this.state.error=ErrorType.INSTRUCTION,this.state.errorData={type:ErrorType.INSTRUCTION,instruction:"LEAVEBUZZER"});break;case OpCodeID.LOAD:this.state.stack[++this.state.sp]=this.program[3*this.state.pc+1];break;case OpCodeID.POP:this.state.sp--;break;case OpCodeID.DUP:this.state.stack[++this.state.sp]=this.state.stack[this.state.sp-1];break;case OpCodeID.DEC:this.state.stack[this.state.sp]-=this.program[3*this.state.pc+1];break;case OpCodeID.INC:this.state.stack[this.state.sp]+=this.program[3*this.state.pc+1];break;case OpCodeID.CALL:this.state.ic++,paramCount=this.state.stack[this.state.sp--],newSP=this.state.sp-paramCount,fname=this.functionNames[this.program[3*this.state.pc+2]],this.state.stack[++this.state.sp]=this.state.fp,this.state.stack[++this.state.sp]=newSP,this.state.stack[++this.state.sp]=this.state.pc,this.state.stack[++this.state.sp]=paramCount,this.state.fp=newSP+1+paramCount,this.state.pc=this.program[3*this.state.pc+1],this.state.jumped=!0,this.state.stackSize++,this.state.stackMemory+=Math.max(1,paramCount),this.state.stackSize>=this.world.maxStackSize?(this.state.running=!1,this.state.error=ErrorType.STACK):this.state.stackMemory>=this.world.maxStackMemory?(this.state.running=!1,this.state.error=ErrorType.STACKMEMORY):paramCount>this.world.maxCallSize?(this.state.running=!1,this.state.error=ErrorType.CALLSIZE):this.disableStackEvents||this.eventController.fireEvent("call",this,{type:"call",function:fname,params:this.state.stack.subarray(this.state.fp-paramCount,this.state.fp),line:this.state.line,target:this});break;case OpCodeID.RET:if(this.state.fp<0){this.state.running=!1;break}paramCount=this.state.stack[this.state.fp+3],this.state.pc=this.state.stack[this.state.fp+2],this.state.sp=this.state.stack[this.state.fp+1],this.state.fp=this.state.stack[this.state.fp],this.state.stackSize--,this.state.stackMemory-=Math.max(1,paramCount),this.disableStackEvents||(params=this.state.stack.subarray(0,0),fromFName=this.functionNames[this.program[3*this.state.pc+2]],fname="N/A",line=-2,this.state.stackSize>=1&&(npc=this.state.stack[this.state.fp+2],fname=this.functionNames[this.program[3*npc+2]],line=this.program[3*(npc+1)+1],paramCount=this.state.stack[this.state.fp+3],params=this.state.stack.subarray(this.state.fp-paramCount,this.state.fp)),this.eventController.fireEvent("return",this,{type:"return",target:this,params:params,function:fname,fromFunction:fromFName,line:line,returnValue:this.state.ret}));break;case OpCodeID.PARAM:this.state.stack[++this.state.sp]=this.state.stack[this.state.fp-1-this.program[3*this.state.pc+1]];break;case OpCodeID.SRET:this.state.ret=this.state.stack[this.state.sp--];break;case OpCodeID.LRET:this.state.stack[++this.state.sp]=this.state.ret;break;case OpCodeID.LT:op2=this.state.stack[this.state.sp--],op1=this.state.stack[this.state.sp--],this.state.stack[++this.state.sp]=op1<op2?1:0;break;case OpCodeID.LTE:op2=this.state.stack[this.state.sp--],op1=this.state.stack[this.state.sp--],this.state.stack[++this.state.sp]=op1<=op2?1:0;break;case OpCodeID.ROW:this.state.stack[++this.state.sp]=this.world.i;break;case OpCodeID.COLUMN:this.state.stack[++this.state.sp]=this.world.j;break;default:return this.state.running=!1,this.debug&&this.eventController.fireEvent("debug",this,{type:"debug",target:this,message:"Missing opcode "+this.rawOpcodes[this.state.pc][0],debugType:"opcode"}),this.state.error=ErrorType.INVALIDOPCODE,this.state.errorData={type:ErrorType.INSTRUCTION,instruction:OpCodeID[this.program[3*this.state.pc]]},!1}if(this.state.jumped?this.state.jumped=!1:this.state.pc++,this.debug){let copy={pc:this.state.pc,stackSize:this.state.stackSize,expressionStack:Array.from(this.state.stack.slice(this.state.fp+4,this.state.sp+1)),line:this.state.line,ic:this.state.ic,running:this.state.running};this.eventController.fireEvent("debug",this,{type:"debug",target:this,message:JSON.stringify(copy),debugType:"state"})}}catch(e){throw this.state.running=!1,console.error(e),console.log(e.stack),e}return!0}}!function(DumpTypes){DumpTypes.DUMP_WORLD="mundo",DumpTypes.DUMP_POSITION="posicion",DumpTypes.DUMP_ORIENTATION="orientacion",DumpTypes.DUMP_INSTRUCTIONS="instrucciones",DumpTypes.DUMP_ALL_BUZZERS="universo",DumpTypes.DUMP_BAG="mochila",DumpTypes.DUMP_MOVE="avanza",DumpTypes.DUMP_LEFT="gira_izquierda",DumpTypes.DUMP_PICK_BUZZER="coge_zumbador",DumpTypes.DUMP_LEAVE_BUZZER="deja_zumbador"}(DumpTypes||(DumpTypes={})),function(ERROR_MAPPING){ERROR_MAPPING.BAGUNDERFLOW="ZUMBADOR INVALIDO",ERROR_MAPPING.WALL="MOVIMIENTO INVALIDO",ERROR_MAPPING.WORLDUNDERFLOW="ZUMBADOR INVALIDO",ERROR_MAPPING.STACK="STACK OVERFLOW",ERROR_MAPPING.INSTRUCTION="LIMITE DE INSTRUCCIONES",ERROR_MAPPING.STACKMEMORY="LIMITE DE MEMORIA DEL STACK",ERROR_MAPPING.CALLSIZE="LIMITE DE LONGITUD DE LLAMADA"}(ERROR_MAPPING||(ERROR_MAPPING={}));class World{constructor(w,h){this.setWallMask=function(i,j,wallMask){let newMask=wallMask;wallMask<0||wallMask>=16||1>i||i>this.h||1>j||j>this.w||(1==j&&(newMask|=1),1==i&&(newMask|=8),i==this.h&&(newMask|=2),j==this.w&&(newMask|=4),this.wallMap[this.w*i+j]=newMask)},this.init(w,h)}init(w,h){this.w=w,this.h=h,this.runtime=new Runtime(this),this.createMaps(),this.clear()}createMaps(){if(ArrayBuffer){let len=(this.w+2)*(this.h+2);this.map=new Int32Array(new ArrayBuffer(4*len)),this.currentMap=new Int32Array(new ArrayBuffer(4*len)),this.wallMap=new Uint8Array(new ArrayBuffer(len))}else{this.map=[],this.currentMap=[],this.wallMap=[];for(let i=0;i<=this.h;i++)for(let j=0;j<=this.w;j++)this.map.push(0),this.currentMap.push(0),this.wallMap.push(0)}}resize(w,h){for(let i=1;i<=this.h;i++)this.wallMap[this.w*i+1]&=-2,this.wallMap[this.w*(i+1)]&=-5;for(let j=1;j<=this.w;j++)this.wallMap[this.w*this.h+j]&=-3,this.wallMap[this.w+j]&=-9;let oldW=this.w,oldH=this.h,oldMap=this.map,oldWallMap=this.wallMap,oldDumpCells=this.dumpCells;this.w=w,this.h=h,this.createMaps(),this.addBorderWalls();for(let i=1;i<=oldH;i++)for(let j=1;j<=oldW;j++)this.setCellWalls(i,j,oldWallMap[oldW*i+j]),this.setBuzzers(i,j,oldMap[oldW*i+j]);this.dumpCells=[];for(let dumpPos=0;dumpPos<oldDumpCells.length;dumpPos++)oldDumpCells[dumpPos][0]<=this.h&&oldDumpCells[dumpPos][1]<=this.w&&this.setDumpCell(oldDumpCells[dumpPos][0],oldDumpCells[dumpPos][1],!0);this.start_i>this.h&&(this.start_i=this.i=this.h),this.start_j>this.w&&(this.start_j=this.j=this.w),this.dirty=!0}clear(){for(let i=0;i<this.wallMap.length;i++)this.wallMap[i]=0;for(let i=0;i<this.map.length;i++)this.map[i]=this.currentMap[i]=0;this.addBorderWalls(),this.orientation=1,this.startOrientation=1,this.start_i=1,this.i=1,this.start_j=1,this.j=1,this.startBagBuzzers=0,this.bagBuzzers=0,this.dumps={},this.dumpCells=[],this.maxInstructions=1e7,this.maxMove=-1,this.maxTurnLeft=-1,this.maxPickBuzzer=-1,this.maxLeaveBuzzer=-1,this.maxStackSize=65e3,this.maxStackMemory=65e3,this.maxCallSize=5,this.worldName="mundo_0",this.programName="p1",this.dirty=!0}walls(i,j){return 0>i||i>this.h||0>j||j>this.w?0:this.wallMap[this.w*i+j]}toggleWall(i,j,orientation){1==j&&0===orientation||1==i&&3==orientation||i==this.h&&1==orientation||j==this.w&&2==orientation||orientation<0||orientation>=4||1>i||i>this.h||1>j||j>this.w||(this.wallMap[this.w*i+j]^=1<<orientation,0===orientation&&j>1?this.wallMap[this.w*i+(j-1)]^=4:1===orientation&&i<this.h?this.wallMap[this.w*(i+1)+j]^=8:2===orientation&&j<this.w?this.wallMap[this.w*i+(j+1)]^=1:3===orientation&&i>1&&(this.wallMap[this.w*(i-1)+j]^=2),this.dirty=!0)}addBorderWalls(){for(let i=1;i<=this.h;i++)this.addWall(i,1,0),this.addWall(i,this.w,2);for(let j=1;j<=this.w;j++)this.addWall(this.h,j,1),this.addWall(1,j,3)}setCellWalls(i,j,wallMask){for(let pos=0;pos<4;pos++)wallMask&1<<pos&&this.addWall(i,j,pos)}addWall(i,j,orientation){orientation<0||orientation>=4||1>i||i>this.h||1>j||j>this.w||(this.wallMap[this.w*i+j]|=1<<orientation,0===orientation&&j>1?this.wallMap[this.w*i+(j-1)]|=4:1===orientation&&i<this.h?this.wallMap[this.w*(i+1)+j]|=8:2===orientation&&j<this.w?this.wallMap[this.w*i+(j+1)]|=1:3===orientation&&i>1&&(this.wallMap[this.w*(i-1)+j]|=2),this.dirty=!0)}setBuzzers(i,j,count){0>=i||i>this.h||0>=j||j>this.w||(this.map[this.w*i+j]=this.currentMap[this.w*i+j]=65535==count?-1:count,this.dirty=!0)}buzzers(i,j){return 0>=i||i>this.h||0>=j||j>this.w?0:this.currentMap[this.w*i+j]}startBuzzers(i,j){return 0>=i||i>this.h||0>=j||j>this.w?0:this.map[this.w*i+j]}pickBuzzer(i,j){0>=i||i>this.h||0>=j||j>this.w||(-1!=this.currentMap[this.w*i+j]&&this.currentMap[this.w*i+j]--,-1!=this.bagBuzzers&&this.bagBuzzers++,this.dirty=!0)}leaveBuzzer(i,j){0>=i||i>this.h||0>=j||j>this.w||(-1!=this.currentMap[this.w*i+j]&&this.currentMap[this.w*i+j]++,-1!=this.bagBuzzers&&this.bagBuzzers--,this.dirty=!0)}setDumpCell(i,j,dumpState){let dumpPos=-1;if(!(0>=i||i>this.h||0>=j||j>this.w)){for(dumpPos=0;dumpPos<this.dumpCells.length&&(this.dumpCells[dumpPos][0]!=i||this.dumpCells[dumpPos][1]!=j);dumpPos++);if(dumpPos<this.dumpCells.length){if(dumpState)return;this.dumpCells.splice(dumpPos,1)}else{if(!dumpState)return;this.dumpCells.push([i,j])}this.dumps[DumpTypes.DUMP_WORLD]=0!==this.dumpCells.length}}toggleDumpCell(i,j){let dumpPos=0;if(!(0>=i||i>=this.h||0>=j||j>=this.w)){for(;dumpPos<this.dumpCells.length&&(this.dumpCells[dumpPos][0]!=i||this.dumpCells[dumpPos][1]!=j);dumpPos++);dumpPos<this.dumpCells.length?this.dumpCells.splice(dumpPos,1):this.dumpCells.push([i,j]),this.dumps[DumpTypes.DUMP_WORLD]=0!==this.dumpCells.length}}getDumpCell(i,j){let dumpPos=-1;for(dumpPos=0;dumpPos<this.dumpCells.length;dumpPos++)if(this.dumpCells[dumpPos][0]==i&&this.dumpCells[dumpPos][1]==j)return!0;return!1}getDumps(dumpFlag){return this.dumps.hasOwnProperty(dumpFlag.toLowerCase())&&this.dumps[dumpFlag]}setDumps(dumpFlag,flagValue){this.dumps[dumpFlag]=flagValue}toggleDumps(dumpFlag){this.setDumps(dumpFlag,!this.getDumps(dumpFlag))}load(doc){const self=this;self.clear();let rules={mundo:function(mundo){let alto=mundo.getAttribute("alto"),ancho=mundo.getAttribute("ancho");alto&&ancho&&(alto=parseInt(alto,10),ancho=parseInt(ancho,10),alto&&ancho&&self.resize(ancho,alto))},condiciones:function(condiciones){self.maxInstructions=parseInt(condiciones.getAttribute("instruccionesMaximasAEjecutar"),10)||1e7,self.maxStackSize=parseInt(condiciones.getAttribute("longitudStack"),10)||65e3,self.maxStackMemory=parseInt(condiciones.getAttribute("memoriaStack"),10)||65e3,self.maxCallSize=parseInt(condiciones.getAttribute("llamadaMaxima"),10)||5},comando:function(comando){let name=comando.getAttribute("nombre"),val=parseInt(comando.getAttribute("maximoNumeroDeEjecuciones"),10);name&&val&&("AVANZA"==name?self.maxMove=val:"GIRA_IZQUIERDA"==name?self.maxTurnLeft=val:"COGE_ZUMBADOR"==name?self.maxPickBuzzer=val:"DEJA_ZUMBADOR"==name&&(self.maxLeaveBuzzer=val))},monton:function(monton){let i=parseInt(monton.getAttribute("y"),10),j=parseInt(monton.getAttribute("x"),10),zumbadores=monton.getAttribute("zumbadores");"INFINITO"==zumbadores?zumbadores=-1:(zumbadores=parseInt(zumbadores,10),isNaN(zumbadores)&&(zumbadores=0)),self.setBuzzers(i,j,zumbadores)},pared:function(pared){let i=parseInt(pared.getAttribute("y1"),10)+1,j=parseInt(pared.getAttribute("x1"),10)+1;if(pared.getAttribute("x2")){let j2=parseInt(pared.getAttribute("x2"),10)+1;j2>j?self.addWall(i,j,3):self.addWall(i,j2,3)}else if(pared.getAttribute("y2")){let i2=parseInt(pared.getAttribute("y2"),10)+1;i2>i?self.addWall(i,j,0):self.addWall(i2,j,0)}},despliega:function(despliega){self.dumps[despliega.getAttribute("tipo").toLowerCase()]=!0},posicionDump:function(dump){self.dumpCells.push([parseInt(dump.getAttribute("y"),10),parseInt(dump.getAttribute("x"),10)])},programa:function(programa){let xKarel=parseInt(programa.getAttribute("xKarel")||programa.getAttribute("xkarel"),10),yKarel=parseInt(programa.getAttribute("yKarel")||programa.getAttribute("ykarel"),10);self.rotate(programa.getAttribute("direccionKarel")||programa.getAttribute("direccionkarel")),self.worldName=programa.getAttribute("mundoDeEjecucion")||programa.getAttribute("mundodeejecucion"),self.programName=programa.getAttribute("nombre"),self.move(yKarel,xKarel);let bagBuzzers=programa.getAttribute("mochilaKarel")||programa.getAttribute("mochilakarel")||0;"INFINITO"==bagBuzzers?self.setBagBuzzers(-1):self.setBagBuzzers(parseInt(bagBuzzers))}};!function traverse(node){let type=node.nodeName;rules.hasOwnProperty(type)&&rules[type](node);for(let i=0;i<node.childNodes.length;i++)node.childNodes.item(i).nodeType===(node.ELEMENT_NODE||Node.ELEMENT_NODE)&&traverse(node.childNodes.item(i))}(doc),self.reset()}serialize(node,name,indentation){let result="";for(let i=0;i<indentation;i++)result+="\t";if("string"==typeof node||"number"==typeof node)return result+node;if(Array.isArray(node)){result="";for(let i=0;i<node.length;i++)result+=this.serialize(node[i],name,indentation)}else{let childResult="";for(let p in node)if(node.hasOwnProperty(p)){if("#"==p[0])continue;childResult+=this.serialize(node[p],p,indentation+1)}if(result+="<"+name,node.hasOwnProperty("#attributes"))for(let p in node["#attributes"])node["#attributes"].hasOwnProperty(p)&&(result+=" "+p+'="'+node["#attributes"][p]+'"');if(node.hasOwnProperty("#text"))result+=">"+node["#text"]+"</"+name+">\n";else if(""==childResult)result+="/>\n";else{result+=">\n",result+=childResult;for(let i=0;i<indentation;i++)result+="\t";result+="</"+name+">\n"}}return result}save(targetState){let result={condiciones:{"#attributes":{instruccionesMaximasAEjecutar:this.maxInstructions,longitudStack:this.maxStackSize,memoriaStack:this.maxStackMemory,llamadaMaxima:this.maxCallSize},comando:[]},mundos:{mundo:{"#attributes":{nombre:this.worldName,ancho:this.w,alto:this.h},monton:[],pared:[],posicionDump:[]}},programas:{"#attributes":{tipoEjecucion:"CONTINUA",intruccionesCambioContexto:1,milisegundosParaPasoAutomatico:0},programa:{"#attributes":{nombre:this.programName,ruta:"{$2$}",mundoDeEjecucion:this.worldName,xKarel:"start"===targetState?this.start_j:this.j,yKarel:"start"===targetState?this.start_i:this.i,direccionKarel:["OESTE","NORTE","ESTE","SUR"]["start"===targetState?this.startOrientation:this.orientation],mochilaKarel:-1==this.bagBuzzers?"INFINITO":"start"===targetState?this.startBagBuzzers:this.bagBuzzers},despliega:[]}}};for(let i=1;i<=this.h;i++)for(let j=1;j<=this.w;j++){let buzzers="start"===targetState?this.startBuzzers(i,j):this.buzzers(i,j);0!==buzzers&&result.mundos.mundo.monton.push({"#attributes":{x:j,y:i,zumbadores:-1==buzzers?"INFINITO":buzzers}})}-1!==this.maxMove&&result.condiciones.comando.push({"#attributes":{nombre:"AVANZA",maximoNumeroDeEjecuciones:this.maxMove}}),-1!==this.maxTurnLeft&&result.condiciones.comando.push({"#attributes":{nombre:"GIRA_IZQUIERDA",maximoNumeroDeEjecuciones:this.maxTurnLeft}}),-1!==this.maxLeaveBuzzer&&result.condiciones.comando.push({"#attributes":{nombre:"DEJA_ZUMBADOR",maximoNumeroDeEjecuciones:this.maxLeaveBuzzer}}),-1!==this.maxPickBuzzer&&result.condiciones.comando.push({"#attributes":{nombre:"COGE_ZUMBADOR",maximoNumeroDeEjecuciones:this.maxPickBuzzer}});for(let i=1;i<=this.h;i++)for(let j=1;j<=this.w;j++){let walls=this.walls(i,j);for(let k=2;k<8;k<<=1)i==this.h&&2==k||j==this.w&&4==k||(walls&k)==k&&(2==k?result.mundos.mundo.pared.push({"#attributes":{x1:j-1,y1:i,x2:j}}):4==k&&result.mundos.mundo.pared.push({"#attributes":{x1:j,y1:i-1,y2:i}}))}for(let i=0;i<this.dumpCells.length;i++)result.mundos.mundo.posicionDump.push({"#attributes":{x:this.dumpCells[i][1],y:this.dumpCells[i][0]}});for(let p in this.dumps)this.dumps.hasOwnProperty(p)&&this.dumps[p]&&result.programas.programa.despliega.push({"#attributes":{tipo:p.toUpperCase()}});return this.serialize(result,"ejecucion",0)}output(){let result={};if(this.dumps[DumpTypes.DUMP_WORLD]||this.dumps[DumpTypes.DUMP_ALL_BUZZERS]){result.mundos={mundo:{"#attributes":{nombre:this.worldName},linea:[]}};let dumpCells={};for(let i=0;i<this.dumpCells.length;i++)dumpCells.hasOwnProperty(this.dumpCells[i][0])||(dumpCells[this.dumpCells[i][0]]={}),dumpCells[this.dumpCells[i][0]][this.dumpCells[i][1]]=!0;for(let i=this.h;i>0;i--){let printCoordinate=!0,line="";for(let j=1;j<=this.w;j++)(dumpCells[i]&&dumpCells[i][j]||this.dumps[DumpTypes.DUMP_ALL_BUZZERS])&&(0!==this.buzzers(i,j)&&(printCoordinate&&(line+="("+j+") "),line+=(65535&this.buzzers(i,j))+" "),printCoordinate=0==this.buzzers(i,j));""!==line&&result.mundos.mundo.linea.push({"#attributes":{fila:i,compresionDeCeros:"true"},"#text":line})}}return result.programas={programa:{"#attributes":{nombre:this.programName}}},result.programas.programa["#attributes"].resultadoEjecucion=this.errorMap(this.runtime.state.error),this.dumps[DumpTypes.DUMP_POSITION]&&(result.programas.programa.karel={"#attributes":{x:this.j,y:this.i}}),this.dumps[DumpTypes.DUMP_ORIENTATION]&&(result.programas.programa.karel=result.programas.programa.karel||{"#attributes":{}},result.programas.programa.karel["#attributes"].direccion=["OESTE","NORTE","ESTE","SUR"][this.orientation]),this.dumps[DumpTypes.DUMP_BAG]&&(result.programas.programa.karel=result.programas.programa.karel||{"#attributes":{}},result.programas.programa.karel["#attributes"].mochila=-1==this.bagBuzzers?"INFINITO":this.bagBuzzers),this.dumps[DumpTypes.DUMP_MOVE]&&(result.programas.programa.instrucciones=result.programas.programa.instrucciones||{"#attributes":{}},result.programas.programa.instrucciones["#attributes"].avanza=this.runtime.state.moveCount),this.dumps[DumpTypes.DUMP_LEFT]&&(result.programas.programa.instrucciones=result.programas.programa.instrucciones||{"#attributes":{}},result.programas.programa.instrucciones["#attributes"].gira_izquierda=this.runtime.state.turnLeftCount),this.dumps[DumpTypes.DUMP_PICK_BUZZER]&&(result.programas.programa.instrucciones=result.programas.programa.instrucciones||{"#attributes":{}},result.programas.programa.instrucciones["#attributes"].coge_zumbador=this.runtime.state.pickBuzzerCount),this.dumps[DumpTypes.DUMP_LEAVE_BUZZER]&&(result.programas.programa.instrucciones=result.programas.programa.instrucciones||{"#attributes":{}},result.programas.programa.instrucciones["#attributes"].deja_zumbador=this.runtime.state.leaveBuzzerCount),this.serialize(result,"resultados",0)}move(i,j){this.i=this.start_i=i,this.j=this.start_j=j,this.dirty=!0}rotate(orientation){let orientations=["OESTE","NORTE","ESTE","SUR"];orientation||(orientation=orientations[(this.orientation+3)%4]),this.orientation=this.startOrientation=Math.max(0,orientations.indexOf(orientation)),this.dirty=!0}setBagBuzzers(buzzers){isNaN(buzzers)&&(buzzers=0),this.bagBuzzers=this.startBagBuzzers=65535==buzzers?-1:buzzers,this.dirty=!0}reset(){this.orientation=this.startOrientation,this.move(this.start_i,this.start_j),this.bagBuzzers=this.startBagBuzzers;for(let i=0;i<this.currentMap.length;i++)this.currentMap[i]=this.map[i];this.runtime.reset(),this.dirty=!0}errorMap(s){return s?ERROR_MAPPING.hasOwnProperty(s)?ERROR_MAPPING[s]:s:"FIN PROGRAMA"}}function removeWhitespaces(str){return str.replace(/\s+/g,"")}async function evaluateFiles(){if(!selectedDirectoryHandle)return void alert("Please select a directory first.");const sourceText=document.getElementById("source").value;let program=null;try{program=function(code,exportDebug=!1){let lang=function(code){let rules=[/^\s+/,/^\/\/[^\n]*/,/^#[^\n]*/,/^(?:\/\*(?:[^*]|\*[^)])*\*\/)/,/^{[^}]*}/,/^\(\*([^*]|\*[^)])*\*\)/,/^[^a-zA-Z0-9_-]+/,/^[a-zA-Z0-9_-]+/],i=0;for(;i<code.length;)for(let j=0;j<rules.length;j++){let m=rules[j].exec(code.substring(i));if(null!==m){if(j==rules.length-1)return"class"==m[0]||"import"==m[0]?"java":"iniciar-programa"==m[0].toLowerCase()||"usa"==m[0].toLowerCase()?"pascal":"unknown";i+=m[0].length;break}}return"unknown"}(code),compiler=null;switch(lang){case"java":compiler=javaCompiler;break;case"pascal":compiler=pascalCompiler;break;default:let errorStatus={error:CompilationError.Errors.UNKNOWN_SYNTAX,line:0,loc:{first_column:0,first_line:1,last_column:0,last_line:1}},error=new Error("Unknown syntax, the start of the file must be either 'class' or 'iniciar-programa'");throw error.hash=errorStatus,error}return compiler(code,exportDebug)}(sourceText,!1)[0]}catch(e){return void alert("Compilation error")}const result=document.getElementById("result");result.innerHTML="";try{async function iterateDirectory(directoryHandle){for await(const entry of directoryHandle.values())if("file"===entry.kind&&entry.name.endsWith(".in")){const outFileName=`${entry.name.slice(0,-3)}.out`,outFileHandle=await directoryHandle.getFileHandle(outFileName,{create:!1}).catch((()=>null));if(!outFileHandle){result.innerHTML+=`<p><b>${entry.name}<b/>: No hay .out</p>`;continue}const outFile=await outFileHandle.getFile(),outFileContent=await outFile.text(),file=await entry.getFile(),content=await file.text(),xml=(new DOMParser).parseFromString(content,"text/xml"),world=new World(1,1);world.load(xml);const runtime=world.runtime;for(runtime.load(program),runtime.start();runtime.step(););if(null!=runtime.state.error){result.innerHTML+=`<p><b>${entry.name}<b/>: Error de ejecución ${runtime.state.error}</p>`;continue}const finalState=world.output(),simple_output=removeWhitespaces(outFileContent),simple_final=removeWhitespaces(finalState);result.innerHTML+=simple_final===simple_output?`<p><b>${entry.name}<b/>: Success</p>`:`<p><b>${entry.name}<b/>: Respuesta incorrecta</p>`}else"directory"===entry.kind&&await iterateDirectory(entry)}await iterateDirectory(selectedDirectoryHandle)}catch(error){console.error("Error iterating through files:",error)}}document.getElementById("path-btn").addEventListener("click",(()=>{!async function(){try{selectedDirectoryHandle=await window.showDirectoryPicker(),document.getElementById("path").textContent=selectedDirectoryHandle.name}catch(error){console.error("Error selecting directory:",error)}}()})),document.getElementById("eval-btn").addEventListener("click",(()=>{null!=selectedDirectoryHandle?evaluateFiles().finally((()=>{document.getElementById("result").innerHTML+="<p><b>Termino</b></p>"})):alert("Fist select a file")}))}();
//# sourceMappingURL=index.js.map
